var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},__extends=function(t,e){function i(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},__assign=Object.assign||function(t){for(var e,i=1,a=arguments.length;a>i;i++){e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},__rest=function(t,e){var i={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(i[a]=t[a]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,a=Object.getOwnPropertySymbols(t);s<a.length;s++)e.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(t,a[s])&&(i[a[s]]=t[a[s]]);return i},__decorate=function(t,e,i,a){var s,n=arguments.length,r=3>n?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,a);else for(var h=t.length-1;h>=0;h--)(s=t[h])&&(r=(3>n?s(r):n>3?s(e,i,r):s(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r},__param=function(t,e){return function(i,a){e(i,a,t)}},__metadata=function(t,e){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(t,e):void 0},__awaiter=function(t,e,i,a){function s(t){return t instanceof i?t:new i(function(e){e(t)})}return new(i||(i=Promise))(function(i,n){function r(t){try{o(a.next(t))}catch(e){n(e)}}function h(t){try{o(a["throw"](t))}catch(e){n(e)}}function o(t){t.done?i(t.value):s(t.value).then(r,h)}o((a=a.apply(t,e||[])).next())})},__generator=function(t,e){function i(t){return function(e){return a([t,e])}}function a(i){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,n&&(r=2&i[0]?n["return"]:i[0]?n["throw"]||((r=n["return"])&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(r=o.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(a){i=[6,a],n=0}finally{s=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,n,r,h,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return h={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},__exportStar=function(t,e){for(var i in t)"default"===i||e.hasOwnProperty(i)||__createBinding(e,t,i)},__createBinding=Object.create?function(t,e,i,a){void 0===a&&(a=i),Object.defineProperty(t,a,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,a){void 0===a&&(a=i),t[a]=e[i]},__values=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],a=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var a,s,n=i.call(t),r=[];try{for(;(void 0===e||e-->0)&&!(a=n.next()).done;)r.push(a.value)}catch(h){s={error:h}}finally{try{a&&!a.done&&(i=n["return"])&&i.call(n)}finally{if(s)throw s.error}}return r},__spread=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t},__spreadArrays=function(){for(var t=0,e=0,i=arguments.length;i>e;e++)t+=arguments[e].length;for(var a=Array(t),s=0,e=0;i>e;e++)for(var n=arguments[e],r=0,h=n.length;h>r;r++,s++)a[s]=n[r];return a},__await=function(t){return this instanceof __await?(this.v=t,this):new __await(t)},__asyncGenerator=function(t,e,i){function a(t){_[t]&&(l[t]=function(e){return new Promise(function(i,a){c.push([t,e,i,a])>1||s(t,e)})})}function s(t,e){try{n(_[t](e))}catch(i){o(c[0][3],i)}}function n(t){t.value instanceof __await?Promise.resolve(t.value.v).then(r,h):o(c[0][2],t)}function r(t){s("next",t)}function h(t){s("throw",t)}function o(t,e){t(e),c.shift(),c.length&&s(c[0][0],c[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,_=i.apply(t,e||[]),c=[];return l={},a("next"),a("throw"),a("return"),l[Symbol.asyncIterator]=function(){return this},l},__asyncDelegator=function(t){function e(e,s){i[e]=t[e]?function(i){return(a=!a)?{value:__await(t[e](i)),done:"return"===e}:s?s(i):i}:s}var i,a;return i={},e("next"),e("throw",function(t){throw t}),e("return"),i[Symbol.iterator]=function(){return this},i},__asyncValues=function(t){function e(e){a[e]=t[e]&&function(a){return new Promise(function(s,n){a=t[e](a),i(s,n,a.done,a.value)})}}function i(t,e,i,a){Promise.resolve(a).then(function(e){t({value:e,done:i})},e)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,s=t[Symbol.asyncIterator];return s?s.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),a={},e("next"),e("throw"),e("return"),a[Symbol.asyncIterator]=function(){return this},a)},__makeTemplateObject=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},__setModuleDefault=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t["default"]=e},__importStar=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&__createBinding(e,t,i);return __setModuleDefault(e,t),e},__importDefault=function(t){return t&&t.__esModule?t:{"default":t}},__classPrivateFieldGet=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)},__classPrivateFieldSet=function(t,e,i){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,i),i},__reflect=function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i};!function(t){function e(a){if(i[a])return i[a].exports;var s=i[a]={i:a,l:!1,exports:{}};return t[a].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,a){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:a})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(e.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(a,s,function(e){return t[e]}.bind(null,s));return a},e.n=function(t){var i=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){i(1),i(2),i(3),i(4),i(5),i(6),i(7),i(8),i(9),i(10),i(11),i(12),i(13),i(14),i(15),i(16),i(17),i(18),i(19),i(20),i(21),i(22),i(23),i(24);var a=function(t){function e(){var e=t.call(this)||this;return e._connection=Connection.instance(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){return console.log("RUN GAME"),this._viewport=A1Viewport.instance(this.stage),this._mainView=this._viewport.register("MAIN_VIEW","FullScreen"),this._state=A1State.instance(this._mainView),this._state.register("SPLASH_SCENE",SplashScene),this._state.register("LAND_SCENE",LandScene),this._state.register("WORLD_SCENE",WorldScene),this._state.register("COMBAT_SCENE",CombatScene),t="https://prototype-ws.herokuapp.com",e="http://localhost:9000",this._connection.connect(t),[2]})})},e}(egret.DisplayObjectContainer);window.Main=a,__reflect(a.prototype,"Main",[])},function(t,e){var i=function(){function t(){var t=this;this.onInitialData=function(){},this.connect=function(e){console.log("SOCKET"),t.socket=io.connect(e);var i=localStorage.getItem("userId");t.socket.emit("request-auth",i),t.socket.on("message",function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return null!=e.path?[3,2]:(this.initialData=e,this.onInitialData(),[4,A1State.instance().setState("SPLASH_SCENE")]);case 1:return t.sent(),this.switchTo(e.location.type),[2];case 2:1===e.path.length&&(this.initialData[e.path[0]]=e.content,this.switchTo(e.content.type)),t.label=3;case 3:return[2]}})})}),t.socket.on("user",function(t){console.log(t),localStorage.setItem("userId",t)})}}return t.instance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.sendAction=function(t){this.socket.emit(t)},t.prototype.switchTo=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:switch(e=t){case"world":return[3,1];case"land":return[3,3];case"combat":return[3,5]}return[3,7];case 1:return[4,A1State.instance().setState("WORLD_SCENE")];case 2:return i.sent(),[2];case 3:return[4,A1State.instance().setState("LAND_SCENE")];case 4:return i.sent(),[2];case 5:return[4,A1State.instance().setState("COMBAT_SCENE")];case 6:return i.sent(),[2];case 7:return[2]}})})},t._instance=null,t}();window.Connection=i,__reflect(i.prototype,"Connection",[])},function(t,e){var i=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();window.DebugPlatform=i,__reflect(i.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new i)},function(t,e){var i=function(t){function e(e,i,a,s,n,r,h){var o=t.call(this)||this;return o.creatureName=e,o.isPlayer=i,o.isParagon=a,o.isWeaken=s,o.image=n,o.creatureId=r,o.ratio=h,o._cover=new egret.Shape,o._mask=new egret.Shape,o._connection=Connection.instance(),o._rat1HPBarBg=new egret.Shape,o._rat1HPBar=new egret.Shape,o.addEventListener(egret.Event.ADDED_TO_STAGE,o.onAddToStage,o),o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,o.onTouch,o),o}return __extends(e,t),e.prototype.onTouch=function(){this._connection.socket.emit("start-combat",this.creatureId)},e.prototype.onAddToStage=function(){this._cover.graphics.beginFill(0),this._cover.graphics.drawRect(0,0,this.width,this.height-20),this._cover.y=8,this._cover.graphics.endFill(),this.addChild(this._cover),this._cImage=this.createBitmapByName(this.image),this._cImage.width=.6*this._cImage.width,this._cImage.height=.6*this._cImage.height,this._cImage.y=this.height/2-this._cImage.height/2,this._mask.graphics.beginFill(0),this._mask.graphics.drawCircle(0,0,this._cImage.height/2),this._mask.x=this._cImage.x+this._cImage.width/2,this._mask.y=this._cImage.y+this._cImage.height/2,this._mask.graphics.endFill(),this.addChild(this._mask),this._cImage.mask=this._mask,this.addChild(this._cImage),this._cName=new egret.TextField,this._cName.size=20;var t=this.isWeaken&&!this.isPlayer?"Weak ":"",e=this.isParagon&&!this.isPlayer?" Paragon":"";this._cName.text=t+this.creatureName+e,this._cName.textColor=this.isPlayer?9228011:this.isParagon?13938487:this.isWeaken?9934743:16711422,this._cName.y=this.height/2-this._cName.height/2,this._cName.x=this._mask.width/2+this._mask.x+20,this.addChild(this._cName),this._rat1HPBarBg.graphics.beginFill(3355443),this._rat1HPBarBg.graphics.drawRect(0,0,this._cover.width-this._cName.x+10,5),this._rat1HPBarBg.x=this._cName.x-10,this._rat1HPBarBg.y=this._cover.y+this._cover.height,this._rat1HPBarBg.graphics.endFill(),this.addChild(this._rat1HPBarBg),this._rat1HPBar.graphics.beginFill(1===this.ratio?13373696:9044739),this._rat1HPBar.graphics.drawRect(0,0,this._rat1HPBarBg.width*this.ratio,5),this._rat1HPBar.x=this._rat1HPBarBg.x,this._rat1HPBar.y=this._rat1HPBarBg.y,this._rat1HPBar.graphics.endFill(),this.addChild(this._rat1HPBar)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);window.Creature=i,__reflect(i.prototype,"Creature",[])},function(t,e){var i=function(t){function e(e,i){var a=t.call(this)||this;return a._window=e,a._parent=i,a._connection=Connection.instance(),a._background=new egret.Shape,a._sb_background=new egret.Shape,a._nm_background=new egret.Shape,a._hpBar=new egret.Shape,a._spBar=new egret.Shape,a._mpBar=new egret.Shape,a._statusBars=new egret.DisplayObjectContainer,a._circle=new egret.Shape,a._barHeight=20,a.addEventListener(egret.Event.ADDED_TO_STAGE,a.onAddToStage,a),a._data=a._connection.initialData.character,a._connection.socket.on("character",function(t){a._data=t,a.renderPlayerImage(),a._name.text=a._data.name,a._name.x=a._nm_background.x+(a.width-a._nm_background.x)/2-a._name.width/2,a.changeHp(a._data.bars.hp,a._data.bars.maxHp),a.changeSp(a._data.bars.sp,a._data.bars.maxSp),a.changeMp(a._data.bars.mp,a._data.bars.maxMp)}),a._connection.socket.on("bars",function(t){t.hasOwnProperty("sp")?a.changeSp(t.sp,t.maxSp):t.hasOwnProperty("hp")?a.changeHp(t.hp,t.maxHp):t.hasOwnProperty("mp")&&a.changeMp(t.mp,t.maxMp)}),a}return __extends(e,t),e.prototype.onAddToStage=function(){var t=this,e=Math.round(.15*this._window.height);this.height=e>100?100:e,this.width=this._window.width,this._background.graphics.beginFill(331795),this._background.graphics.drawRect(0,0,this.width,this.height),this._background.graphics.endFill(),this.addChild(this._background),this.renderPlayerImage(),this.addChild(this._circle);var i=Math.round(3*this.height/5);this._sb_background.graphics.beginFill(988440),this._sb_background.graphics.drawRect(0,0,this.width-this._circle.width-30,i),this._sb_background.graphics.endFill(),this._statusBars.addChild(this._sb_background),this._statusBars.x=this._circle.width+30,this._statusBars.y=Math.round(.4*(this.height-i)),this.addChild(this._statusBars),this._nm_background.graphics.lineStyle(1,7303023),this._nm_background.graphics.drawRect(0,0,this.width-this._circle.width-2,this._statusBars.y),this._nm_background.x=this._circle.width,this.addChild(this._nm_background),this._name=new egret.TextField,this._name.size=Math.round(.8*this._nm_background.height),this._name.text=this._data.name,this._name.x=this._nm_background.x+(this.width-this._nm_background.x)/2-this._name.width/2,this._name.y=1+this._nm_background.height/2-this._name.height/2,this.addChild(this._name);var a=Math.round(.175*this._sb_background.height/4);this._barHeight=Math.round((this._sb_background.height-4*a)/3),this._hpLabel=new egret.TextField,this._hpLabel.size=Math.round(.7*this._barHeight),this._hpLabel.text="HP:",this._hpLabel.y=1+this._nm_background.height+a+(this._barHeight/2-this._hpLabel.height/2),this._hpLabel.x=this._nm_background.x+28-this._hpLabel.width;var s=this._nm_background.x+28,n=this.width-s;this.addChild(this._hpLabel);var r=this._data.bars.hp/this._data.bars.maxHp;this._hpBar.graphics.beginFill(1===r?10880261:9175811),this._hpBar.graphics.drawRect(0,0,this._statusBars.width*r-1,this._barHeight),this._hpBar.graphics.endFill(),this._hpBar.y=a+1,this._statusBars.addChild(this._hpBar),r=this._data.bars.sp/this._data.bars.maxSp,this._spBar.graphics.beginFill(15900733),this._spBar.graphics.drawRect(0,0,this._statusBars.width*r-1,this._barHeight),this._spBar.graphics.endFill(),this._spBar.y=this._hpBar.y+this._hpBar.height+a,this._statusBars.addChild(this._spBar),r=this._data.bars.mp/this._data.bars.maxMp,this._mpBar.graphics.beginFill(1844134),this._mpBar.graphics.drawRect(0,0,this._statusBars.width*r-1,this._barHeight),this._mpBar.graphics.endFill(),this._mpBar.y=this._spBar.y+this._spBar.height+a,this._statusBars.addChild(this._mpBar),this._spLabel=new egret.TextField,this._spLabel.size=this._hpLabel.size,this._spLabel.text="SP:",this._spLabel.y=this._hpLabel.y+this._barHeight+a,this._spLabel.x=s-this._spLabel.width,this.addChild(this._spLabel),this._mpLabel=new egret.TextField,this._mpLabel.size=this._hpLabel.size,this._mpLabel.text="MP:",this._mpLabel.y=this._spLabel.y+this._barHeight+a,this._mpLabel.x=s-this._mpLabel.width,this.addChild(this._mpLabel),this._hpText=new egret.TextField,this._hpText.size=this._hpLabel.size,this._hpText.text=this._data.bars.hp+" / "+this._data.bars.maxHp,this._hpText.y=this._hpLabel.y,this._hpText.x=s+n/2-this._hpText.width/2,this.addChild(this._hpText),this._spText=new egret.TextField,this._spText.size=this._hpLabel.size,this._spText.text=this._data.bars.sp+" / "+this._data.bars.maxSp,this._spText.y=this._spLabel.y,this._spText.x=s+n/2-this._spText.width/2,this.addChild(this._spText),this._mpText=new egret.TextField,this._mpText.size=this._hpLabel.size,this._mpText.text=this._data.bars.mp+" / "+this._data.bars.maxMp,this._mpText.y=this._mpLabel.y,this._mpText.x=s+n/2-this._mpText.width/2,this.addChild(this._mpText),this._connection.socket.on("player-sp",function(e){var i=e.split("/");t.changeSp(i[0],i[1])}),this._connection.socket.on("player-hp",function(e){var i=e.split("/");t.changeHp(i[0],i[1])})},e.prototype.renderPlayerImage=function(){if(this._rat1)this._rat1.texture=RES.getRes(this._data.image);else{this._rat1=this.createBitmapByName(this._data.image);var t=this.height/this._rat1.height;this._rat1.height=this.height,this._rat1.width=this._rat1.width*t,this._rat1.x=0-(this._rat1.width-this._rat1.height)/2,this.addChild(this._rat1),this._circle.graphics.clear(),this._circle.graphics.beginFill(65280),this._circle.graphics.drawCircle(0,0,this._rat1.height/2),this._circle.graphics.endFill(),this._circle.x=this._rat1.height/2,this._circle.y=this._rat1.height/2,this._rat1.mask=this._circle,this._rat1.touchEnabled=!0,this._rat1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStatsTap,this)}},e.prototype.onStatsTap=function(){var t=this._parent.getChildByName("statsScreen");t.toggleVisible()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.changeHp=function(t,e){this._hpText.text=t+" / "+e;var i=this._nm_background.x+28,a=this.width-i;this._hpText.x=i+a/2-this._hpText.width/2,this._hpBar.graphics.clear();var s=parseInt(t)/parseInt(e);this._hpBar.graphics.beginFill(1===s?10880261:9175811),this._hpBar.graphics.drawRect(0,0,this._statusBars.width*s,this._barHeight),this._hpBar.graphics.endFill()},e.prototype.changeSp=function(t,e){this._spText.text=t+" / "+e;var i=this._nm_background.x+28,a=this.width-i;this._spText.x=i+a/2-this._spText.width/2,this._spBar.graphics.clear();var s=parseInt(t)/parseInt(e);this._spBar.graphics.beginFill(15900733),this._spBar.graphics.drawRect(0,0,this._statusBars.width*s,this._barHeight),this._spBar.graphics.endFill()},e.prototype.changeMp=function(t,e){this._mpText.text=t+" / "+e;var i=this._nm_background.x+28,a=this.width-i;this._mpText.x=i+a/2-this._mpText.width/2,this._mpBar.graphics.clear();var s=parseInt(t)/parseInt(e);this._mpBar.graphics.beginFill(1844134),this._mpBar.graphics.drawRect(0,0,this._statusBars.width*s,this._barHeight),this._mpBar.graphics.endFill()},e.prototype.update=function(){},e}(egret.DisplayObjectContainer);window.GameHeader=i,__reflect(i.prototype,"GameHeader",[])},function(t,e){var i=function(t){function e(e,i){var a=t.call(this)||this;return a._vp=e,a._height=i,a._connection=Connection.instance(),a._logBg=new egret.Shape,a._scrollView=new egret.ScrollView,a._c={p:14680031,e:16768991,n:7303023,sk:1091061,st:7780891},a._fontsize=18,a._isExpanded=!1,a.addLogText=function(t,e){var i=new egret.TextField;i.size=a._fontsize,i.width=a._vp.width-20,i.wordWrap=!0,i.textColor=e,i.text=t,i.x=10,i.y=10,a._scrollContent.$children.forEach(function(t){t.y+=i.height+3}),a._scrollContent.addChild(i)},a.addEventListener(egret.Event.ADDED_TO_STAGE,a.onAddToStage,a),a._data=a._connection.initialData.logs,a}return __extends(e,t),e.prototype.onAddToStage=function(){var t=this;this._logBg.graphics.lineStyle(1,7303023),this._logBg.graphics.beginFill(331795);var e=this._height;this._logBg.graphics.drawRect(-1,0,this._vp.width+1,e),this._logBg.graphics.endFill(),this.addChild(this._logBg),this._fontsize=Math.round((this._logBg.height-10)/6-3),this._scrollView.width=this._logBg.width,this._scrollView.height=this._logBg.height,this._scrollView.y=this._logBg.y,this.addChild(this._scrollView),this._scrollContent=new egret.DisplayObjectContainer,this._scrollContent.width=this._logBg.width,this._scrollView.setContent(this._scrollContent),this._data.forEach(function(e){t.addLogText(e.msg,t._c[e.t])}),this._connection.socket.on("log",function(e){t.addLogText(e.msg,t._c[e.t])})},e.prototype.setHeight=function(t){this._isExpanded=!!t,this._logBg.graphics.clear(),this._logBg.graphics.lineStyle(1,7303023),this._logBg.graphics.beginFill(331795);var e=null==t?this._height:t;this._logBg.graphics.drawRect(-1,0,this._vp.width+1,e),this._logBg.graphics.endFill(),this._scrollView.y=this._logBg.y,this._scrollView.height=this._logBg.height,this.y=this.parent.getChildByName("skills").y-this._logBg.height},e}(egret.DisplayObjectContainer);window.GameLog=i,__reflect(i.prototype,"GameLog",[])},function(t,e){var i=function(t){function e(e,i,a){var s=t.call(this)||this;return s.landName=e,s.image=i,s.landId=a,s._grad=new egret.Shape,s._cover=new egret.Shape,s._mask=new egret.Shape,s._connection=Connection.instance(),s.addEventListener(egret.Event.ADDED_TO_STAGE,s.onAddToStage,s),s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_TAP,s.onTouch,s),s}return __extends(e,t),e.prototype.onTouch=function(){return"0"===this.landId?void this._connection.socket.emit("prototype-world"):"1"===this.landId?void this._connection.socket.emit("others-world"):void this._connection.socket.emit("go-to-land",this.landId)},e.prototype.onAddToStage=function(){this._landBg=this.createBitmapByName(this.image),this._landBg.width=.68*this.width,this._landBg.x=.32*this.width,this._landBg.height=this.height+70,this._landBg.y=-35,this._mask.graphics.beginFill(0),this._mask.graphics.drawRect(0,0,this.width,this.height),this._mask.graphics.endFill(),this.addChild(this._mask),this._landBg.mask=this._mask,this.addChild(this._landBg),this._cover.graphics.beginFill(0),this._cover.graphics.drawRect(0,0,.3*this.width,this.height),this._cover.graphics.endFill(),this.addChild(this._cover),this._grad.graphics.beginGradientFill(egret.GradientType.LINEAR,[0,0,0],[1,1,0],[0,170,255]),this._grad.graphics.drawRect(0,0,255,this.height),this._grad.graphics.endFill(),this._grad.x=.3*this.width,this.addChild(this._grad),this._landText=new egret.TextField,this._landText.size=28,this._landText.text=this.landName,this._landText.textColor=10000536,this._landText.y=this.height/2-this._landText.height/2,this._landText.x=30,this.addChild(this._landText)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);window.Land=i,__reflect(i.prototype,"Land",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._cellSize=e,i._skill1=new egret.Shape,i._skill2=new egret.Shape,i._skill3=new egret.Shape,i._skill4=new egret.Shape,i._skill5=new egret.Shape,i._skill6=new egret.Shape,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.onAddToStage=function(t){this._skill1.graphics.lineStyle(1,7303023),this._skill1.graphics.beginFill(198416),this._skill1.graphics.drawRect(0,0,this._cellSize,this._cellSize),this._skill1.graphics.endFill(),this.addChild(this._skill1),this._skill2.graphics.lineStyle(1,7303023),this._skill2.graphics.beginFill(198416),this._skill2.graphics.drawRect(0,0,this._cellSize,this._cellSize),this._skill2.x=this._skill1.width,this._skill2.graphics.endFill(),this.addChild(this._skill2),this._skill3.graphics.lineStyle(1,7303023),this._skill3.graphics.beginFill(198416),this._skill3.graphics.drawRect(0,0,this._cellSize,this._cellSize),this._skill3.x=this._skill2.x+this._skill2.width,this._skill3.graphics.endFill(),this.addChild(this._skill3),this._skill4.graphics.lineStyle(1,7303023),this._skill4.graphics.beginFill(198416),this._skill4.graphics.drawRect(0,0,this._cellSize,this._cellSize),this._skill4.x=this._skill3.x+this._skill3.width,this._skill4.graphics.endFill(),this.addChild(this._skill4),this._skill5.graphics.lineStyle(1,7303023),this._skill5.graphics.beginFill(198416),this._skill5.graphics.drawRect(0,0,this._cellSize,this._cellSize),this._skill5.x=this._skill4.x+this._skill4.width,this._skill5.graphics.endFill(),this.addChild(this._skill5),this._skill6.graphics.lineStyle(1,7303023),this._skill6.graphics.beginFill(198416),this._skill6.graphics.drawRect(0,0,this._cellSize,this._cellSize),this._skill6.x=this._skill5.x+this._skill5.width,this._skill6.graphics.endFill(),this.addChild(this._skill6)},e}(egret.DisplayObjectContainer);window.SkillBar=i,__reflect(i.prototype,"SkillBar",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i._bg=new egret.Shape,i._scrollBg=new egret.Shape,i._viewport=A1Viewport.instance(),i._connection=Connection.instance(),i._strTextLabel=new egret.TextField,i._dexTextLabel=new egret.TextField,i._intTextLabel=new egret.TextField,i._hpTextLabel=new egret.TextField,i._spTextLabel=new egret.TextField,i._mpTextLabel=new egret.TextField,i._strText=new egret.TextField,i._dexText=new egret.TextField,i._intText=new egret.TextField,i._hpText=new egret.TextField,i._spText=new egret.TextField,i._mpText=new egret.TextField,i._titleBar=new egret.Shape,i._title=new egret.TextField,i._baseDamageLabel=new egret.TextField,i._baseDamage=new egret.TextField,i._resistTitle=new egret.TextField,i._dmgTypesTitle=new egret.TextField,i._scrollView=new egret.ScrollView,i._scrollContent=new egret.DisplayObjectContainer,i._cMap={physical:8097941,fire:14833698,cold:10740180,poison:4583724,energy:12517631},i.toggleVisible=function(){if(i.visible=!i.visible,!i.visible)return void(i._scrollView.scrollTop=0);var t=i._parent.getChildByName("gameLog"),e=i._parent.getChildByName("gameHeader");i._bg.graphics.clear(),i._bg.graphics.beginFill(331795),i._bg.graphics.drawRect(0,0,i._viewport.windowProps().width,t.y-e.height),i._bg.graphics.endFill(),i._scrollView.height=i._bg.height-i._titleBar.height,i._scrollBg.graphics.clear(),i._scrollBg.graphics.beginFill(331795),i._scrollBg.graphics.drawRect(0,0,i._viewport.windowProps().width,t.y-e.height),i._scrollBg.graphics.endFill()},i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i._initialData=i._connection.initialData.character,i}return __extends(e,t),e.prototype.onAddToStage=function(){this.addChild(this._bg);var t=this._parent.getChildByName("gameHeader");console.log(this._initialData),this._titleBar.graphics.lineStyle(1,15724527),this._titleBar.graphics.beginFill(1250067),this._titleBar.graphics.drawRect(0,0,this._viewport.windowProps().width-1,t.height/4),this._titleBar.graphics.endFill(),this._titleBar.y=0,this.addChild(this._titleBar),this._title.size=Math.round(.7*this._titleBar.height),this._title.text="Stats",this._title.textColor=9934743,this._title.y=this._titleBar.y+this._titleBar.height/2-this._title.height/2,this._title.x=this._titleBar.width/2-this._title.width/2,this.addChild(this._title),this._scrollView.y=this._titleBar.y+this._titleBar.height,this._scrollView.width=this._viewport.windowProps().width,this.addChild(this._scrollView),this._scrollContent.width=this._viewport.windowProps().width,this._scrollView.setContent(this._scrollContent),this.applyData(),this.registerListeners()},e.prototype.applyData=function(){this._scrollContent.removeChildren();var t=this._parent.getChildByName("gameHeader");this._scrollContent.addChild(this._scrollBg),this._strTextLabel.text="Strength:",this._strTextLabel.size=16,this._strTextLabel.x=t.height/12,this._strTextLabel.y=t.height/12-1,this._strTextLabel.textColor=9934743,this._scrollContent.addChild(this._strTextLabel),this._dexTextLabel.text="Dexterity:",this._dexTextLabel.size=16,this._dexTextLabel.x=t.height/12,this._dexTextLabel.y=this._strTextLabel.y+this._strTextLabel.height+t.height/12-1,this._dexTextLabel.textColor=9934743,this._scrollContent.addChild(this._dexTextLabel),this._intTextLabel.text="Intelligence:",this._intTextLabel.size=16,this._intTextLabel.x=t.height/12,this._intTextLabel.y=this._dexTextLabel.y+this._dexTextLabel.height+t.height/12-1,this._intTextLabel.textColor=9934743,this._scrollContent.addChild(this._intTextLabel),this._strText.text=this._initialData.stats.str,this._strText.size=16,this._strText.x=this._intTextLabel.x+this._intTextLabel.width+t.height/8,this._strText.y=this._strTextLabel.y,this._strText.textColor=16777215,this._scrollContent.addChild(this._strText),this._dexText.text=this._initialData.stats.dex,this._dexText.size=16,this._dexText.x=this._intTextLabel.x+this._intTextLabel.width+t.height/8,this._dexText.y=this._dexTextLabel.y,this._dexText.textColor=16777215,this._scrollContent.addChild(this._dexText),this._intText.text=this._initialData.stats["int"],this._intText.size=16,this._intText.x=this._intTextLabel.x+this._intTextLabel.width+t.height/8,this._intText.y=this._intTextLabel.y,this._intText.textColor=16777215,this._scrollContent.addChild(this._intText),this._hpTextLabel.text="Health:",this._hpTextLabel.size=16,this._hpTextLabel.x=this.getSLabelsX(t),this._hpTextLabel.y=this._strTextLabel.y,this._hpTextLabel.textColor=9934743,this._scrollContent.addChild(this._hpTextLabel),this._spTextLabel.text="Stamina:",this._spTextLabel.size=16,this._spTextLabel.x=this._hpTextLabel.x,this._spTextLabel.y=this._dexTextLabel.y,this._spTextLabel.textColor=9934743,this._scrollContent.addChild(this._spTextLabel),this._mpTextLabel.text="Mana:",this._mpTextLabel.size=16,this._mpTextLabel.x=this._hpTextLabel.x,this._mpTextLabel.y=this._intTextLabel.y,this._mpTextLabel.textColor=9934743,this._scrollContent.addChild(this._mpTextLabel),this._hpText.text=this._initialData.bars.hp+" / "+this._initialData.bars.maxHp,this._hpText.size=16,this._hpText.x=this._spTextLabel.x+this._spTextLabel.width+t.height/8,this._hpText.y=this._strTextLabel.y,this._hpText.textColor=16777215,this._scrollContent.addChild(this._hpText),this._spText.text=this._initialData.bars.sp+" / "+this._initialData.bars.maxSp,this._spText.size=16,this._spText.x=this._spTextLabel.x+this._spTextLabel.width+t.height/8,this._spText.y=this._dexTextLabel.y,this._spText.textColor=16777215,this._scrollContent.addChild(this._spText),this._mpText.text=this._initialData.bars.mp+" / "+this._initialData.bars.maxMp,this._mpText.size=16,this._mpText.x=this._spTextLabel.x+this._spTextLabel.width+t.height/8,this._mpText.y=this._intTextLabel.y,this._mpText.textColor=16777215,this._scrollContent.addChild(this._mpText);var e=this._mpText,i=!1;for(var a in this._initialData.skills)if(this._initialData.skills.hasOwnProperty(a)){var s=new egret.TextField;s.text=a+":",s.size=16,s.x=i?this._hpTextLabel.x:this._strTextLabel.x,e?s.y=i?e.y:e.y+e.height+t.height/12-1:s.y=this._intTextLabel.y+this._intTextLabel.height+t.height/4,s.textColor=9934743,this._scrollContent.addChild(s);var n=new egret.TextField;n.text=this._initialData.skills[a]+"%",n.size=16,n.x=i?this._hpText.x:this._strText.x,n.name=a,n.y=s.y,n.textColor=16777215,this._scrollContent.addChild(n),e=s,i=!i
}this._baseDamageLabel.text="Base damage:",this._baseDamageLabel.size=16,this._baseDamageLabel.x=this._strTextLabel.x,this._baseDamageLabel.y=e.y+e.height+t.height/4,this._baseDamageLabel.textColor=9934743,this._scrollContent.addChild(this._baseDamageLabel),e=this._baseDamageLabel,this._baseDamage.text=this._initialData.baseDmgMin+" - "+this._initialData.baseDmgMax,this._baseDamage.size=16,this._baseDamage.x=this._baseDamageLabel.x+this._baseDamageLabel.width+t.height/8,this._baseDamage.y=this._baseDamageLabel.y,this._baseDamage.textColor=16777215,this._scrollContent.addChild(this._baseDamage),this._resistTitle.text="Damage Resists",this._resistTitle.size=16,this._resistTitle.x=this._strTextLabel.x,this._resistTitle.y=e.y+e.height+t.height/4,this._resistTitle.textColor=16777215,this._scrollContent.addChild(this._resistTitle),e=this._resistTitle;for(var a in this._initialData.resists)if(this._initialData.resists.hasOwnProperty(a)){var s=new egret.TextField;s.text=a.charAt(0).toUpperCase()+a.slice(1)+":",s.size=16,s.x=this._strTextLabel.x,s.y=e.y+e.height+t.height/12-1,s.textColor=9934743,this._scrollContent.addChild(s);var r=new egret.TextField;r.text=this._initialData.resists[a]+"%",r.size=16,r.x=this._strText.x,r.name=a,r.y=s.y,r.textColor=this._cMap[a],this._scrollContent.addChild(r),e=s}this._dmgTypesTitle.text="Damage Types",this._dmgTypesTitle.size=16,this._dmgTypesTitle.x=this._spTextLabel.x,this._dmgTypesTitle.y=this._resistTitle.y,this._dmgTypesTitle.textColor=16777215,this._scrollContent.addChild(this._dmgTypesTitle),e=this._dmgTypesTitle;for(var a in this._initialData.damage)if(this._initialData.damage.hasOwnProperty(a)){var s=new egret.TextField;s.text=a.charAt(0).toUpperCase()+a.slice(1)+":",s.size=16,s.x=this._spTextLabel.x,s.y=e.y+e.height+t.height/12-1,s.textColor=9934743,this._scrollContent.addChild(s);var r=new egret.TextField;r.text=this._initialData.damage[a]+"%",r.size=16,r.x=this._spText.x,r.name=a,r.y=s.y,r.textColor=this._cMap[a],this._scrollContent.addChild(r),e=s}this._scrollContent.height=e.y+e.height+t.height/12-1},e.prototype.registerListeners=function(){var t=this;this._connection.socket.on("character",function(e){t._initialData=e,t.applyData()}),this._connection.socket.on("bars",function(e){e.hasOwnProperty("sp")?t._spText.text=e.sp+" / "+e.maxSp:e.hasOwnProperty("hp")?t._hpText.text=e.hp+" / "+e.maxHp:e.hasOwnProperty("mp")&&(t._mpText.text=e.mp+" / "+e.maxMp)}),this._connection.socket.on("stats",function(e){e.hasOwnProperty("strength")?t._strText.text=e.strength:e.hasOwnProperty("dexterity")?t._dexText.text=e.dexterity:e.hasOwnProperty("intelligence")&&(t._intText.text=e.intelligence)}),this._connection.socket.on("skills",function(e){for(var i in e)if(e.hasOwnProperty(i)){var a=t._scrollContent.getChildByName(i);a.text=e[i]+"%"}})},e.prototype.getSLabelsX=function(t){var e=this._strText.x+this._strText.width+t.height/1.5,i=this._dexText.x+this._dexText.width+t.height/1.5,a=this._intText.x+this._intText.width+t.height/1.5;return e>i?e>a?e:a:i>a?i:a},e}(egret.DisplayObjectContainer);window.StatsScreen=i,__reflect(i.prototype,"StatsScreen",[])},function(t,e){var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(egret.DisplayObjectContainer);window.StatusBar=i,__reflect(i.prototype,"StatusBar",[])},function(t,e){var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.update=function(){return void{}},e._viewport=A1Viewport.instance(),e}return __extends(e,t),e.prototype.onViewCreated=function(){},e.prototype.onViewStopped=function(){},e.prototype.onRunState=function(){},e.prototype.stop=function(){this._viewport.offResize(this.update),this.onViewStopped()},e.prototype.createView=function(){this._viewport.onResize(this.update),this.onViewCreated()},e.prototype.loadAssets=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.createView(),this.update(),[2]})})},e}(egret.DisplayObjectContainer);window.A1Scene=i,__reflect(i.prototype,"A1Scene",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i.update=function(){i._text.x=(i._parent.width-i.width)/2,i._text.y=(i._parent.height-i.height)/2},i}return __extends(e,t),e.prototype.onViewCreated=function(){console.log("LOADING_SCENE"),this._text=new egret.TextField,this._text.size=32,this._text.text="Loading... 0/0",this.addChild(this._text),this.update()},e.prototype.onProgress=function(t,e){console.log("LOADING_SCENE: Loading... "+t+"/"+e),this._text.text="Loading... "+t+"/"+e,this.update()},e}(A1Scene);window.A1LoadingScene=i,__reflect(i.prototype,"A1LoadingScene",["RES.PromiseTaskReporter"])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i.update=function(){i._text.x=(i._parent.width-i.width)/2,i._text.y=(i._parent.height-i.height)/2},i.createView(),i.update(),i}return __extends(e,t),e.prototype.onViewCreated=function(){console.log("SPLASH_SCREEN"),this._text=new egret.TextField,this._text.size=32,this._text.text="A1 Core Game",this.addChild(this._text)},e}(A1Scene);window.A1SplashScene=i,__reflect(i.prototype,"A1SplashScene",[])},function(t,e){var i=function(){function t(t){this._container=t,this._scenes=new Map,this._constructors=new Map,this._constructors.set("SPLASH_SCREEN",A1SplashScene),this._constructors.set("LOADING_SCENE",A1LoadingScene)}return t.instance=function(e){return null==t._instance&&null!=e&&(t._instance=new t(e)),t._instance},t.prototype.register=function(t,e){this._constructors.set(t,e)},t.prototype.setState=function(t){return void 0===t&&(t="SPLASH_SCREEN"),__awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return console.log("setState",t),this._state===t?[2,this._currentStateScene]:(this.stopCurrentState(),this._state=t,e=this,[4,this.runState(t)]);case 1:return e._currentStateScene=i.sent(),[2,this._currentStateScene]}})})},t.prototype.update=function(){this._currentStateScene.update()},t.prototype.runState=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return console.log("runState",t),e=this._scenes.get(t),e?(this._container.addChildAt(e,0),e.onRunState(),[2,this._scenes.get(t)]):[4,this.createNewScene(t)];case 1:return e=i.sent(),this._container.addChildAt(e,0),[2,e]}})})},t.prototype.createNewScene=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return console.log("createNewScene",t),e=this.constructScene(t),"SPLASH_SCREEN"===t?[3,2]:[4,this.loadSceneAssets(e)];case 1:i.sent(),i.label=2;case 2:return[2,e]}})})},t.prototype.loadSceneAssets=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(a){switch(a.label){case 0:return console.log("loadSceneAssets "+this._state),this._scenes.has("LOADING_SCENE")?(i=this._scenes.get("LOADING_SCENE"),[3,3]):[3,1];case 1:return[4,this.createLoadingScene()];case 2:i=a.sent(),a.label=3;case 3:return e=i,this._container.addChild(e),[4,t.loadAssets(e)];case 4:return a.sent(),e.stop(),this._container.removeChild(e),[2]}})})},t.prototype.wait3400=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t,e){setTimeout(function(){t()},0)})]})})},t.prototype.createLoadingScene=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return console.log("createLoadingScene"),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),t=this.constructScene("SPLASH_SCREEN"),this._container.addChild(t),[4,this.wait3400()];case 2:return i.sent(),e=this.constructScene("LOADING_SCENE"),[4,e.loadAssets(void 0)];case 3:return i.sent(),t.stop(),this._container.removeChild(t),[2,e]}})})},t.prototype.constructScene=function(t){console.log("constructScene "+t);var e=this._constructors.get(t),i=new e(this._container);return this._scenes.set(t,i),i},t.prototype.stopCurrentState=function(){console.log("stopCurrentState",this._state),null!=this._currentStateScene&&(this._currentStateScene.stop(),this._container.removeChild(this._currentStateScene))},t}();window.A1State=i,__reflect(i.prototype,"A1State",[])},function(t,e){},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.updateDimentions=function(t){t.ratio<APP_ASPECT_RATIO?this.setThinScreen(t):this.setWideScreen(t),this.updateRectangle()},e.prototype.createView=function(){this._rect=new egret.Shape,this.addChild(this._rect)},e.prototype.updateRectangle=function(){this._rect.graphics.clear(),this._rect.graphics.lineStyle(1,16711680),this._rect.graphics.drawRect(0,0,this.width-2,this.height-2)},e.prototype.setThinScreen=function(t){this.width=t.width,this.height=this.width/APP_ASPECT_RATIO,this.x=0,this.y=(t.height-this.height)/2},e.prototype.setWideScreen=function(t){this.width=t.height*APP_ASPECT_RATIO,this.height=t.height,this.x=(t.width-this.width)/2,this.y=0},e}(egret.DisplayObjectContainer);window.A1AspectScreen=i,__reflect(i.prototype,"A1AspectScreen",["IA1Screen"])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.updateDimentions=function(t){this.width=t.width,this.height=t.height,this.updateRectangle()},e.prototype.createView=function(){this._rect=new egret.Shape,this.addChild(this._rect)},e.prototype.updateRectangle=function(){this._rect.graphics.clear(),this._rect.graphics.lineStyle(0,65280),this._rect.graphics.drawRect(0,0,this.width-2,this.height-2)},e}(egret.DisplayObjectContainer);window.A1FullScreen=i,__reflect(i.prototype,"A1FullScreen",["IA1Screen"])},function(t,e){var i=640;window.APP_CONTENT_WIDTH=i;var a=1136;window.APP_CONTENT_HEIGHT=a;var s=i/a;window.APP_ASPECT_RATIO=s;var n=function(){function t(t){this._stage=t,this._layers=new Map,this._resizeSubscribers=new Set,this._canvas=document.querySelector(".egret-player canvas"),this._stage.addEventListener(egret.Event.RESIZE,this.onStageResize,this),this.onStageResize(),this._viewport=new egret.DisplayObjectContainer,this._stage.addChild(this._viewport)}return t.instance=function(e){return null==t._instance&&null!=e&&(t._instance=new t(e)),t._instance},t.prototype.register=function(t,e){if(this._layers.has(t))return this._layers.get(t);if(null==e)return null;var i=this.createScreenByType(e);return null==i?null:(this._layers.set(t,i),this._viewport.addChild(i),i.updateDimentions(this.windowProps()),i)},t.prototype.toAspectSize=function(t){return t*this._aspectScale},t.prototype.onResize=function(t){this._resizeSubscribers.add(t)},t.prototype.offResize=function(t){this._resizeSubscribers["delete"](t)},t.prototype.notifyResize=function(){this._resizeSubscribers.forEach(function(t){t()})},t.prototype.applyAspectRatio=function(t){this._layers.forEach(function(e){e.updateDimentions(t)})},t.prototype.createScreenByType=function(t){switch(t){case"FullScreen":return new A1FullScreen;case"AspectScreen":return new A1AspectScreen;default:return null}},t.prototype.onStageResize=function(){var t=this.windowProps();this.updateAspectScale(t),this.applyAspectRatio(t),this.notifyResize()},t.prototype.updateAspectScale=function(t){if(t.ratio<s)return void(this._aspectScale=t.width/i);var e=t.height*s;this._aspectScale=e/i},t.prototype.windowProps=function(){return{width:this._canvas.width/window.devicePixelRatio,height:this._canvas.height/window.devicePixelRatio,ratio:this._canvas.width/this._canvas.height}},t}();window.A1Viewport=n,__reflect(n.prototype,"A1Viewport",[])},function(t,e){},function(t,e){},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i._connection=Connection.instance(),i._state=A1State.instance(),i._titleBar=new egret.Shape,i._title=new egret.TextField,i._rat1bg=new egret.Shape,i._rat2bg=new egret.Shape,i._vs=new egret.TextField,i._rat1HPBarBg=new egret.Shape,i._rat2HPBarBg=new egret.Shape,i._rat1HPBar=new egret.Shape,i._rat2HPBar=new egret.Shape,i._isCreated=!1,i._leaveCombatBtnBg=new egret.Shape,i._isAlive=!0,i.onCombatHp=function(t){return t.hasOwnProperty("hp1")?void i.onPlayerHp(t.hp1,t.hp1Max,t.dmg):t.hasOwnProperty("hp2")?void i.onEnemyHp(t.hp2,t.hp2Max,t.dmg):void 0},i.onPlayerHp=function(t,e,a){var s=t/e;i._isAlive=t>0,i._rat1HPBar.graphics.clear(),i._rat1HPBar.graphics.beginFill(1===s?13373696:9044739),i._rat1HPBar.graphics.drawRect(0,0,i._rat1.width*s,5),i._rat1HPBar.graphics.endFill()},i.onEnemyHp=function(t,e,a){var s=t/e;i._rat2HPBar.graphics.clear(),i._rat2HPBar.graphics.beginFill(1===s?13373696:9044739),i._rat2HPBar.graphics.drawRect(0,0,i._rat1.width*s,5),i._rat2HPBar.graphics.endFill()},i.update=function(){},i._combatInitialData=i._connection.initialData.location,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.onViewCreated=function(){var t=this;if(!this._isCreated&&this._combatInitialData){console.log("COMBAT_SCENE");var e=Math.round(.15*this._viewport.windowProps().height),i=e>100?100:e,a=this._viewport.windowProps().width;this._titleBar.graphics.lineStyle(1,15724527),this._titleBar.graphics.beginFill(1250067),this._titleBar.graphics.drawRect(0,0,a-1,i/4),this._titleBar.graphics.endFill(),this._titleBar.y=i,this.addChild(this._titleBar),this._title.size=Math.round(.7*this._titleBar.height),this._title.text=this._combatInitialData.isFinished?"Combat Log":"Combat",this._title.textColor=9934743,this._title.y=this._titleBar.y+this._titleBar.height/2-this._title.height/2,this._title.x=this._titleBar.width/2-this._title.width/2,this.addChild(this._title),this._rat1bg.graphics.beginFill(0);var s=.85*a/2,n=s/188;this._rat1bg.graphics.drawRect(0,0,s,138*n),this._rat1bg.graphics.endFill(),this._rat1bg.y=this._titleBar.y+i/2.5+1,this._rat1bg.x=i/8,this.addChild(this._rat1bg),this._rat2bg.graphics.beginFill(0),this._rat2bg.graphics.drawRect(0,0,this._rat1bg.width,this._rat1bg.height),this._rat2bg.graphics.endFill(),this._rat2bg.y=this._rat1bg.y,this._rat2bg.x=a-this._rat1bg.width-i/8,this.addChild(this._rat2bg),this._rat1HPBarBg.graphics.beginFill(3355443),this._rat1HPBarBg.graphics.drawRect(0,0,this._rat1bg.width,5),this._rat1HPBarBg.x=this._rat1bg.x,this._rat1HPBarBg.y=this._rat1bg.y+this._rat1bg.height,this._rat1HPBarBg.graphics.endFill(),this.addChild(this._rat1HPBarBg);var r=this._combatInitialData.rat1HP.split("/"),h=parseInt(r[0])/parseInt(r[1]);this._rat1HPBar.graphics.beginFill(1===h?13373696:9044739),this._rat1HPBar.graphics.drawRect(0,0,this._rat1HPBarBg.width*h,5),this._rat1HPBar.x=this._rat1HPBarBg.x,this._rat1HPBar.y=this._rat1HPBarBg.y,this._rat1HPBar.graphics.endFill(),this.addChild(this._rat1HPBar),this._rat2HPBarBg.graphics.beginFill(3355443),this._rat2HPBarBg.graphics.drawRect(0,0,this._rat1HPBarBg.width,6),this._rat2HPBarBg.x=this._rat2bg.x,this._rat2HPBarBg.y=this._rat1HPBarBg.y,this._rat2HPBarBg.graphics.endFill(),this.addChild(this._rat2HPBarBg);var o=this._combatInitialData.rat2HP.split("/");h=parseInt(o[0])/parseInt(o[1]),this._rat2HPBar.graphics.beginFill(1===h?13373696:9044739),this._rat2HPBar.graphics.drawRect(0,0,this._rat2HPBarBg.width*h,6),this._rat2HPBar.x=this._rat2HPBarBg.x,this._rat2HPBar.y=this._rat2HPBarBg.y,this._rat2HPBar.graphics.endFill(),this.addChild(this._rat2HPBar),this._vs.size=20,this._vs.text="VS",this._vs.textColor=16777215,this._vs.y=this._rat1bg.y+this._rat1bg.height/2-this._vs.height/2+3,this._vs.x=a/2-this._vs.width/2,this.addChild(this._vs),this._connection.socket.on("combat-end",function(e){t.renderLeaveCombatBtn(),t._title.text="Combat Log",t._title.x=t._titleBar.width/2-t._title.width/2,t._connection.socket.off("combat-hp",t.onCombatHp)}),this.applyData(),this._isCreated=!0}},e.prototype.onAddToStage=function(){var t=this.parent.getChildByName("gameLog");t.setHeight(this.parent.getChildByName("skills").y-this._rat1HPBarBg.y-66-4*this._rat1HPBarBg.x)},e.prototype.applyData=function(){this._rat1=this.createBitmapByName(this._combatInitialData.rat1Img),this._rat1.y=this._rat1bg.y,this._rat1.x=this._rat1bg.x,this._rat1.width=this._rat1bg.width,this._rat1.height=this._rat1bg.height,this.addChild(this._rat1),this._rat2=this.createBitmapByName(this._combatInitialData.rat2Img),this._rat2.y=this._rat2bg.y,this._rat2.x=this._rat2bg.x,this._rat2.width=this._rat2bg.width,this._rat2.height=this._rat2bg.height,this.addChild(this._rat2);var t=this._combatInitialData.rat1HP.split("/");this.onPlayerHp(parseInt(t[0]),parseInt(t[1]),0);var e=this._combatInitialData.rat2HP.split("/");return this.onEnemyHp(parseInt(e[0]),parseInt(e[1]),0),this._title.text=this._combatInitialData.isFinished?"Combat Log":"Combat",this._title.x=this._titleBar.width/2-this._title.width/2,this._combatInitialData.isFinished?void(this._leaveCombatBtn||this.renderLeaveCombatBtn()):void this._connection.socket.on("combat-hp",this.onCombatHp)},e.prototype.renderLeaveCombatBtn=function(){this._leaveCombatBtn=new egret.DisplayObjectContainer,this._leaveCombatBtn.width=this._viewport.windowProps().width-2*this._rat1HPBarBg.x,this._leaveCombatBtn.height=60,this._leaveCombatBtn.y=this._rat1HPBarBg.y+this._rat1HPBarBg.height+2*this._rat1HPBarBg.x,this._leaveCombatBtn.x=this._rat1HPBarBg.x,this._leaveCombatBtnBg.graphics.beginFill(1644825),this._leaveCombatBtnBg.graphics.drawRect(0,0,this._leaveCombatBtn.width,this._leaveCombatBtn.height),this._leaveCombatBtnBg.graphics.endFill(),this._leaveCombatBtn.addChild(this._leaveCombatBtnBg),this._leaveCombatBtnLabel=new egret.TextField,this._leaveCombatBtnLabel.size=28,this._leaveCombatBtnLabel.text=this._isAlive?"Leave Combat":"Release your Soul",this._leaveCombatBtnLabel.textColor=9934743,this._leaveCombatBtnLabel.y=this._leaveCombatBtnBg.y+this._leaveCombatBtnBg.height/2-this._leaveCombatBtnLabel.height/2,this._leaveCombatBtnLabel.x=this._leaveCombatBtnBg.width/2-this._leaveCombatBtnLabel.width/2,this._leaveCombatBtn.addChild(this._leaveCombatBtnLabel),this.addChild(this._leaveCombatBtn),this._leaveCombatBtn.touchEnabled=!0,this._leaveCombatBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.leaveCombat,this)},e.prototype.leaveCombat=function(){this._isAlive?this._connection.sendAction("leave-combat"):this._connection.sendAction("respawn-player")},e.prototype.onRunState=function(){this._combatInitialData=this._connection.initialData.location,this.applyData()},e.prototype.onViewStopped=function(){var t=this._parent.getChildByName("gameLog");t.setHeight(),this._connection.socket.off("combat-hp",this.onCombatHp),this._leaveCombatBtn&&(this.removeChild(this._leaveCombatBtn),this._leaveCombatBtn=null),this._rat1&&(this.removeChild(this._rat1),this._rat1=null),this._rat2&&(this.removeChild(this._rat2),this._rat2=null)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(A1Scene);window.CombatScene=i,__reflect(i.prototype,"CombatScene",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i._state=A1State.instance(),i._backGroundInitialSize={width:0,height:0},i.update=function(){i.resizeBackground()},i._textures=[],i}return __extends(e,t),e.prototype.loadAssets=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,RES.loadGroup("preload",0,t)];case 1:return i.sent(),console.log("loadSceneAssets DONE"),this.createView(),[3,3];case 2:return e=i.sent(),console.error(e),[3,3];case 3:return[2]}})})},e.prototype.onViewCreated=function(){console.log("HOME_SCENE"),this._backGround=this.createBitmapByName("bg_jpg"),this._backGroundInitialSize.width=this._backGround.width,this._backGroundInitialSize.height=this._backGround.height,this.resizeBackground(),this.addChild(this._backGround)},e.prototype.resizeBackground=function(){var t=this._viewport.toAspectSize(this._backGroundInitialSize.width);this._viewport.toAspectSize(this._backGroundInitialSize.height);if(this._parent.width>t){this._backGround.width=this._parent.width,this._backGround.height=this._backGroundInitialSize.height*(this._parent.width/this._backGroundInitialSize.width);var e=this._backGround.height-this._parent.height;this._backGround.x=0,this._backGround.y=-(e/2)}else{this._backGround.height=this._parent.height,this._backGround.width=this._backGroundInitialSize.width*(this._parent.height/this._backGroundInitialSize.height);var i=this._backGround.width-this._parent.width;this._backGround.y=0,this._backGround.x=-(i/2)}},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return this._textures.push(i),e.texture=i,e},e}(A1Scene);window.HomeScene=i,__reflect(i.prototype,"HomeScene",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i._connection=Connection.instance(),i._scrollBg=new egret.Shape,i._titleBar=new egret.Shape,i._title=new egret.TextField,i._landsScrollView=new egret.ScrollView,i._leaveLandBtnBg=new egret.Shape,i._isCreated=!1,i.leaveLand=function(){i._connection.socket.emit("leave-land")},i.update=function(){},i._landInitialData=i._connection.initialData.location,i}return __extends(e,t),e.prototype.onViewCreated=function(){var t=this;if(!this._isCreated&&this._landInitialData){console.log("LAND_SCENE");var e=Math.round(.15*this._viewport.windowProps().height),i=e>100?100:e;this._titleBar.graphics.lineStyle(1,15724527),this._titleBar.graphics.beginFill(1250067),this._titleBar.graphics.drawRect(0,0,this._viewport.windowProps().width-1,i/4),this._titleBar.graphics.endFill(),this._titleBar.y=i,this.addChild(this._titleBar),this._title.size=Math.round(.7*this._titleBar.height),this._title.text="Undefined Land",this._title.textColor=9934743,this._title.y=this._titleBar.y+this._titleBar.height/2-this._title.height/2,this.addChild(this._title),this._landsScrollView.width=this._viewport.windowProps().width,this._landsScrollView.height=this._parent.getChildByName("gameLog").y-i-i/4-2,this._landsScrollView.y=i+i/4+1,this.addChild(this._landsScrollView),this._landsScrollContent=new egret.DisplayObjectContainer,this._landsScrollContent.width=this._viewport.windowProps().width,this._landsScrollView.setContent(this._landsScrollContent),this.applyData(),this._connection.socket.on("location",function(e){"rats"===e.path[0]&&(t._landInitialData.rats=e.content,t.onViewStopped(),t.applyData())}),this._isCreated=!0}},e.prototype.onRunState=function(){this._landInitialData=this._connection.initialData.location,this.applyData()},e.prototype.onViewStopped=function(){this._leaveLandBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.leaveLand,this),this._landsScrollView.scrollTop=0,this._landsScrollContent.removeChildren()},e.prototype.applyData=function(){var t=this;this._scrollBg.graphics.clear(),this._landsScrollContent.addChild(this._scrollBg),this._title.text=this._landInitialData.name,this._title.x=this._titleBar.width/2-this._title.width/2;var e;if(0===this._landInitialData.rats.length){this._landImage=this.createBitmapByName(this._landInitialData.image);var i=this._viewport.windowProps().width,a=i/this._landImage.width;this._landImage.width=i,this._landImage.height=this._landImage.height*a*.7,this._landsScrollContent.addChild(this._landImage),e=this._landImage}else this._landInitialData.rats.forEach(function(i){var a=new Creature(i.name,i.isPlayer,i.isParagon,i.isWeaken,i.image,i.id,i.hp);a.width=t._viewport.windowProps().width-30,a.height=60,a.x=15,e?a.y=e.y+e.height+15:a.y=15,e=a,t._landsScrollContent.addChild(a)});this._leaveLandBtn=new egret.DisplayObjectContainer,this._leaveLandBtn.width=this._viewport.windowProps().width-30,this._leaveLandBtn.height=60,this._leaveLandBtn.y=e.y+e.height+15,this._leaveLandBtn.x=15,this._leaveLandBtnBg.graphics.beginFill(1644825),this._leaveLandBtnBg.graphics.drawRect(0,0,this._leaveLandBtn.width,this._leaveLandBtn.height),this._leaveLandBtnBg.graphics.endFill(),this._leaveLandBtn.addChild(this._leaveLandBtnBg),this._leaveLandBtnLabel=new egret.TextField,this._leaveLandBtnLabel.size=28,this._leaveLandBtnLabel.text="Leave Land",this._leaveLandBtnLabel.textColor=9934743,this._leaveLandBtnLabel.y=this._leaveLandBtnBg.y+this._leaveLandBtnBg.height/2-this._leaveLandBtnLabel.height/2,this._leaveLandBtnLabel.x=this._leaveLandBtnBg.width/2-this._leaveLandBtnLabel.width/2,this._leaveLandBtn.addChild(this._leaveLandBtnLabel),this._landsScrollContent.addChild(this._leaveLandBtn),this._leaveLandBtn.touchEnabled=!0,this._leaveLandBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.leaveLand,this),this._landsScrollContent.height=75*this._landInitialData.rats.length+15+75,this._scrollBg.graphics.beginFill(0,.01),this._scrollBg.graphics.drawRect(0,0,this._viewport.windowProps().width,this._landsScrollContent.height),this._scrollBg.graphics.endFill()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(A1Scene);window.LandScene=i,__reflect(i.prototype,"LandScene",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i._connection=Connection.instance(),i._state=A1State.instance(),i.update=function(){i._text.x=(i._parent.width-i.width)/2,i._text.y=(i._parent.height-i.height)/2},i}return __extends(e,t),e.prototype.loadAssets=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,RES.loadGroup("preload",0,t)];case 1:return i.sent(),console.log("loadSceneAssets DONE"),this.createView(),this.update(),[3,3];case 2:return e=i.sent(),console.error(e),[3,3];case 3:return[2]}})})},e.prototype.onAddToStage=function(){},e.prototype.onViewCreated=function(){console.log("SPLASH_SCENE"),this._text=new egret.TextField,this._text.size=32,this._text.text="A1 Core Game",this.addChild(this._text),this.renderStatics()},e.prototype.renderStatics=function(){var t=this._viewport.windowProps(),e=new GameHeader(t,this._parent);e.name="gameHeader",this._parent.addChild(e);var i=t.width/6-1,a=new SkillBar(i);a.y=t.height-i,a.name="skills",a.height=i,this._parent.addChild(a);var s=e.height,n=new GameLog(t,s);n.name="gameLog",n.y=t.height-i-s,this._parent.addChild(n);var r=new StatsScreen(this._parent);r.y=e.height,r.name="statsScreen",r.visible=!1,this._parent.addChild(r)},e}(A1Scene);window.SplashScene=i,__reflect(i.prototype,"SplashScene",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i._connection=Connection.instance(),i._scrollBg=new egret.Shape,i._titleBar=new egret.Shape,i._title=new egret.TextField,i._landsScrollView=new egret.ScrollView,i._isCreated=!1,i.update=function(){},i._worldInitialData=i._connection.initialData.location,i}return __extends(e,t),e.prototype.onViewCreated=function(){var t=this;if(!this._isCreated&&this._worldInitialData){console.log("WORLD_SCENE");var e=Math.round(.15*this._viewport.windowProps().height),i=e>100?100:e,a=this._viewport.windowProps().width;this._titleBar.graphics.lineStyle(1,15724527),this._titleBar.graphics.beginFill(1250067),this._titleBar.graphics.drawRect(0,0,a-1,i/4),this._titleBar.graphics.endFill(),this._titleBar.y=i,this.addChild(this._titleBar),this._title.size=Math.round(.7*this._titleBar.height),this._title.text=this._worldInitialData.name,this._title.textColor=9934743,this._title.y=this._titleBar.y+this._titleBar.height/2-this._title.height/2,this.addChild(this._title),this._landsScrollView.width=this._viewport.windowProps().width,this._landsScrollView.height=this._parent.getChildByName("gameLog").y-i-i/4-2,this._landsScrollView.y=i+i/4+1,this.addChild(this._landsScrollView),this._landsScrollContent=new egret.DisplayObjectContainer,this._landsScrollContent.width=this._viewport.windowProps().width,this._landsScrollView.setContent(this._landsScrollContent),this.onRunState(),this._isCreated=!0,this._connection.socket.on("world-data",function(e){t._landsScrollView.scrollTop=0,t.onViewStopped(),t._worldInitialData=e,t.applyData()})}},e.prototype.onRunState=function(){this._worldInitialData=this._connection.initialData.location,this.applyData()},e.prototype.onViewStopped=function(){this._landsScrollContent.removeChildren()},e.prototype.applyData=function(){var t=this;this.onViewStopped(),this._scrollBg.graphics.clear(),this._landsScrollContent.addChild(this._scrollBg),this._title.text=this._worldInitialData.name,this._title.x=this._titleBar.width/2-this._title.width/2;var e;this._worldInitialData.lands.push({name:"Prototype World",image:"portal_png",id:"0"}),this._worldInitialData.lands.push({name:"Others World",image:"portal_1_png",id:"1"}),this._worldInitialData.lands.forEach(function(i){var a=new Land(i.name,i.image,i.id);a.width=t._viewport.windowProps().width-30,a.height=60,a.x=15,e?a.y=e.y+e.height+15:a.y=15,e=a,t._landsScrollContent.addChild(a)}),this._landsScrollContent.height=75*this._worldInitialData.lands.length+15,this._scrollBg.graphics.beginFill(0,.01),this._scrollBg.graphics.drawRect(0,0,this._viewport.windowProps().width,this._landsScrollContent.height),this._scrollBg.graphics.endFill()},e}(A1Scene);window.WorldScene=i,__reflect(i.prototype,"WorldScene",[])}]);