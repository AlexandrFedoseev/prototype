var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},__extends=function(t,e){function i(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;n>i;i++){e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},__rest=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,n=Object.getOwnPropertySymbols(t);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(t,n[a])&&(i[n[a]]=t[n[a]]);return i},__decorate=function(t,e,i,n){var a,r=arguments.length,s=3>r?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var h=t.length-1;h>=0;h--)(a=t[h])&&(s=(3>r?a(s):r>3?a(e,i,s):a(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},__param=function(t,e){return function(i,n){e(i,n,t)}},__metadata=function(t,e){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(t,e):void 0},__awaiter=function(t,e,i,n){function a(t){return t instanceof i?t:new i(function(e){e(t)})}return new(i||(i=Promise))(function(i,r){function s(t){try{o(n.next(t))}catch(e){r(e)}}function h(t){try{o(n["throw"](t))}catch(e){r(e)}}function o(t){t.done?i(t.value):a(t.value).then(s,h)}o((n=n.apply(t,e||[])).next())})},__generator=function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,r&&(s=2&i[0]?r["return"]:i[0]?r["throw"]||((s=r["return"])&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(s=o.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(n){i=[6,n],r=0}finally{a=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var a,r,s,h,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return h={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},__exportStar=function(t,e){for(var i in t)"default"===i||e.hasOwnProperty(i)||__createBinding(e,t,i)},__createBinding=Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]},__values=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,a,r=i.call(t),s=[];try{for(;(void 0===e||e-->0)&&!(n=r.next()).done;)s.push(n.value)}catch(h){a={error:h}}finally{try{n&&!n.done&&(i=r["return"])&&i.call(r)}finally{if(a)throw a.error}}return s},__spread=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t},__spreadArrays=function(){for(var t=0,e=0,i=arguments.length;i>e;e++)t+=arguments[e].length;for(var n=Array(t),a=0,e=0;i>e;e++)for(var r=arguments[e],s=0,h=r.length;h>s;s++,a++)n[a]=r[s];return n},__await=function(t){return this instanceof __await?(this.v=t,this):new __await(t)},__asyncGenerator=function(t,e,i){function n(t){c[t]&&(l[t]=function(e){return new Promise(function(i,n){_.push([t,e,i,n])>1||a(t,e)})})}function a(t,e){try{r(c[t](e))}catch(i){o(_[0][3],i)}}function r(t){t.value instanceof __await?Promise.resolve(t.value.v).then(s,h):o(_[0][2],t)}function s(t){a("next",t)}function h(t){a("throw",t)}function o(t,e){t(e),_.shift(),_.length&&a(_[0][0],_[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,c=i.apply(t,e||[]),_=[];return l={},n("next"),n("throw"),n("return"),l[Symbol.asyncIterator]=function(){return this},l},__asyncDelegator=function(t){function e(e,a){i[e]=t[e]?function(i){return(n=!n)?{value:__await(t[e](i)),done:"return"===e}:a?a(i):i}:a}var i,n;return i={},e("next"),e("throw",function(t){throw t}),e("return"),i[Symbol.iterator]=function(){return this},i},__asyncValues=function(t){function e(e){n[e]=t[e]&&function(n){return new Promise(function(a,r){n=t[e](n),i(a,r,n.done,n.value)})}}function i(t,e,i,n){Promise.resolve(n).then(function(e){t({value:e,done:i})},e)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,a=t[Symbol.asyncIterator];return a?a.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),n={},e("next"),e("throw"),e("return"),n[Symbol.asyncIterator]=function(){return this},n)},__makeTemplateObject=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},__setModuleDefault=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t["default"]=e},__importStar=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&__createBinding(e,t,i);return __setModuleDefault(e,t),e},__importDefault=function(t){return t&&t.__esModule?t:{"default":t}},__classPrivateFieldGet=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)},__classPrivateFieldSet=function(t,e,i){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,i),i},__reflect=function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i};!function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var a in t)e.d(n,a,function(e){return t[e]}.bind(null,a));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){i(1),i(2),i(3),i(4),i(5),i(6),i(7),i(8),i(9),i(10),i(11),i(12),i(13),i(14),i(15),i(16),i(17),i(18),i(19),i(20),i(21),i(22),i(23);var n=function(t){function e(){var e=t.call(this)||this;return e._connection=Connection.instance(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){return console.log("RUN GAME"),t="https://prototype-ws.herokuapp.com",e="http://localhost:9000",this._connection.connect(t),this._viewport=A1Viewport.instance(this.stage),this._mainView=this._viewport.register("MAIN_VIEW","FullScreen"),this._state=A1State.instance(this._mainView),this._state.register("SPLASH_SCENE",SplashScene),this._state.setState("SPLASH_SCENE"),this._state.register("LAND_SCENE",LandScene),this._state.register("WORLD_SCENE",WorldScene),this._state.register("COMBAT_SCENE",CombatScene),[2]})})},e}(egret.DisplayObjectContainer);window.Main=n,__reflect(n.prototype,"Main",[])},function(t,e){var i=function(){function t(){}return t.instance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.connect=function(t){console.log("SOCKET"),this.socket=io.connect(t);var e=localStorage.getItem("userId");this.socket.emit("request-auth",e),this.socket.on("user",function(t){console.log(t),localStorage.setItem("userId",t)})},t.prototype.sendAction=function(t){this.socket.emit(t)},t._instance=null,t}();window.Connection=i,__reflect(i.prototype,"Connection",[])},function(t,e){var i=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();window.DebugPlatform=i,__reflect(i.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new i)},function(t,e){var i=function(t){function e(e,i,n,a){var r=t.call(this)||this;return r.creatureName=e,r.image=i,r.creatureId=n,r.ratio=a,r._cover=new egret.Shape,r._mask=new egret.Shape,r._connection=Connection.instance(),r._rat1HPBarBg=new egret.Shape,r._rat1HPBar=new egret.Shape,r.addEventListener(egret.Event.ADDED_TO_STAGE,r.onAddToStage,r),r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,r.onTouch,r),r}return __extends(e,t),e.prototype.onTouch=function(){this._connection.socket.emit("start-combat",this.creatureId)},e.prototype.onAddToStage=function(){this._cover.graphics.beginFill(0),this._cover.graphics.drawRect(0,0,this.width,this.height-20),this._cover.y=8,this._cover.graphics.endFill(),this.addChild(this._cover),this._cImage=this.createBitmapByName(this.image),this._cImage.width=.6*this._cImage.width,this._cImage.height=.6*this._cImage.height,this._cImage.y=this.height/2-this._cImage.height/2,this._mask.graphics.beginFill(0),this._mask.graphics.drawCircle(0,0,this._cImage.height/2),this._mask.x=this._cImage.x+this._cImage.width/2,this._mask.y=this._cImage.y+this._cImage.height/2,this._mask.graphics.endFill(),this.addChild(this._mask),this._cImage.mask=this._mask,this.addChild(this._cImage),this._cName=new egret.TextField,this._cName.size=28,this._cName.text=this.creatureName,this._cName.textColor=15066597,this._cName.y=this.height/2-this._cName.height/2,this._cName.x=this._mask.width/2+this._mask.x+20,this.addChild(this._cName),this._rat1HPBarBg.graphics.beginFill(3355443),this._rat1HPBarBg.graphics.drawRect(0,0,this._cover.width-this._cName.x+10,5),this._rat1HPBarBg.x=this._cName.x-10,this._rat1HPBarBg.y=this._cover.y+this._cover.height,this._rat1HPBarBg.graphics.endFill(),this.addChild(this._rat1HPBarBg),this._rat1HPBar.graphics.beginFill(1===this.ratio?13373696:9044739),this._rat1HPBar.graphics.drawRect(0,0,this._rat1HPBarBg.width*this.ratio,5),this._rat1HPBar.x=this._rat1HPBarBg.x,this._rat1HPBar.y=this._rat1HPBarBg.y,this._rat1HPBar.graphics.endFill(),this.addChild(this._rat1HPBar)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);window.Creature=i,__reflect(i.prototype,"Creature",[])},function(t,e){var i=function(t){function e(e,i){var n=t.call(this)||this;return n._playerInitialData=e,n._window=i,n._connection=Connection.instance(),n._background=new egret.Shape,n._sb_background=new egret.Shape,n._nm_background=new egret.Shape,n._hpBar=new egret.Shape,n._spBar=new egret.Shape,n._mpBar=new egret.Shape,n._statusBars=new egret.DisplayObjectContainer,n._circle=new egret.Shape,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n._connection.socket.on("new",function(){n._connection.socket.on("player-data",function(t){n._playerInitialData=JSON.parse(t),n.renderPlayerImage(),n._name.text=n._playerInitialData.name,n._name.x=n._nm_background.x+(n.width-n._nm_background.x)/2-n._name.width/2,n.changeHp(n._playerInitialData.hp,n._playerInitialData.maxHp),n.changeSp(n._playerInitialData.sp,n._playerInitialData.maxSp),n.changeMp(n._playerInitialData.mp,n._playerInitialData.maxMp)}),n._connection.socket.emit("ask-player-data")}),n}return __extends(e,t),e.prototype.onAddToStage=function(){var t=this,e=Math.round(.15*this._window.height);this.height=e>100?100:e,this.width=this._window.width,this._background.graphics.beginFill(331795),this._background.graphics.drawRect(0,0,this.width,this.height),this._background.graphics.endFill(),this.addChild(this._background),this.renderPlayerImage(),this.addChild(this._circle);var i=Math.round(3*this.height/5);this._sb_background.graphics.beginFill(988440),this._sb_background.graphics.drawRect(0,0,this.width-this._circle.width-30,i),this._sb_background.graphics.endFill(),this._statusBars.addChild(this._sb_background),this._statusBars.x=this._circle.width+30,this._statusBars.y=Math.round(.4*(this.height-i)),this.addChild(this._statusBars),this._nm_background.graphics.lineStyle(1,7303023),this._nm_background.graphics.drawRect(0,0,this.width-this._circle.width-2,this._statusBars.y),this._nm_background.x=this._circle.width,this.addChild(this._nm_background),this._name=new egret.TextField,this._name.size=Math.round(.8*this._nm_background.height),this._name.text=this._playerInitialData.name,this._name.x=this._nm_background.x+(this.width-this._nm_background.x)/2-this._name.width/2,this._name.y=1+this._nm_background.height/2-this._name.height/2,this.addChild(this._name);var n=Math.round(.1*this._sb_background.height/4),a=Math.round((this._sb_background.height-4*n)/3);this._hpLabel=new egret.TextField,this._hpLabel.size=Math.round(.7*a),this._hpLabel.text="HP:",this._hpLabel.y=1+this._nm_background.height+n+(a/2-this._hpLabel.height/2),this._hpLabel.x=this._nm_background.x+28-this._hpLabel.width;var r=this._nm_background.x+28,s=this.width-r;this.addChild(this._hpLabel);var h=this._playerInitialData.hp/this._playerInitialData.maxHp;this._hpBar.graphics.beginFill(1===h?10880261:9175811),this._hpBar.graphics.drawRect(0,0,this._statusBars.width*h-1,a),this._hpBar.graphics.endFill(),this._hpBar.y=n+1,this._statusBars.addChild(this._hpBar),h=this._playerInitialData.sp/this._playerInitialData.maxSp,this._spBar.graphics.beginFill(15900733),this._spBar.graphics.drawRect(0,0,this._statusBars.width*h-1,a),this._spBar.graphics.endFill(),this._spBar.y=this._hpBar.y+this._hpBar.height+n,this._statusBars.addChild(this._spBar),h=this._playerInitialData.mp/this._playerInitialData.maxMp,this._mpBar.graphics.beginFill(1844134),this._mpBar.graphics.drawRect(0,0,this._statusBars.width*h-1,a),this._mpBar.graphics.endFill(),this._mpBar.y=this._spBar.y+this._spBar.height+n,this._statusBars.addChild(this._mpBar),this._spLabel=new egret.TextField,this._spLabel.size=this._hpLabel.size,this._spLabel.text="SP:",this._spLabel.y=this._hpLabel.y+a+n,this._spLabel.x=r-this._spLabel.width,this.addChild(this._spLabel),this._mpLabel=new egret.TextField,this._mpLabel.size=this._hpLabel.size,this._mpLabel.text="MP:",this._mpLabel.y=this._spLabel.y+a+n,this._mpLabel.x=r-this._mpLabel.width,this.addChild(this._mpLabel),this._hpText=new egret.TextField,this._hpText.size=this._hpLabel.size,this._hpText.text=this._playerInitialData.hp+" / "+this._playerInitialData.maxHp,this._hpText.y=this._hpLabel.y,this._hpText.x=r+s/2-this._hpText.width/2,this.addChild(this._hpText),this._spText=new egret.TextField,this._spText.size=this._hpLabel.size,this._spText.text=this._playerInitialData.sp+" / "+this._playerInitialData.maxSp,this._spText.y=this._spLabel.y,this._spText.x=r+s/2-this._spText.width/2,this.addChild(this._spText),this._mpText=new egret.TextField,this._mpText.size=this._hpLabel.size,this._mpText.text=this._playerInitialData.mp+" / "+this._playerInitialData.maxMp,this._mpText.y=this._mpLabel.y,this._mpText.x=r+s/2-this._mpText.width/2,this.addChild(this._mpText),this._connection.socket.on("player-sp",function(e){console.log("on-sp");var i=e.split("/");t.changeSp(i[0],i[1])}),this._connection.socket.on("player-hp",function(e){console.log("on-hp");var i=e.split("/");t.changeHp(i[0],i[1])})},e.prototype.renderPlayerImage=function(){if(this._rat1)this._rat1.texture=RES.getRes(this._playerInitialData.image);else{this._rat1=this.createBitmapByName(this._playerInitialData.image);var t=this.height/this._rat1.height;this._rat1.height=this.height,this._rat1.width=this._rat1.width*t,this._rat1.x=0-(this._rat1.width-this._rat1.height)/2,this.addChild(this._rat1),console.log("addMask"),this._circle.graphics.clear(),this._circle.graphics.beginFill(65280),this._circle.graphics.drawCircle(0,0,this._rat1.height/2),this._circle.graphics.endFill(),this._circle.x=this._rat1.height/2,this._circle.y=this._rat1.height/2,this._rat1.mask=this._circle}},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.changeHp=function(t,e){this._hpText.text=t+" / "+e;var i=this._nm_background.x+28,n=this.width-i;this._hpText.x=i+n/2-this._hpText.width/2,this._hpBar.graphics.clear();var a=parseInt(t)/parseInt(e);this._hpBar.graphics.beginFill(1===a?10880261:9175811),this._hpBar.graphics.drawRect(0,0,this._statusBars.width*a,20),this._hpBar.graphics.endFill()},e.prototype.changeSp=function(t,e){this._spText.text=t+" / "+e;var i=this._nm_background.x+28,n=this.width-i;this._spText.x=i+n/2-this._spText.width/2,this._spBar.graphics.clear();var a=parseInt(t)/parseInt(e);this._spBar.graphics.beginFill(15900733),this._spBar.graphics.drawRect(0,0,this._statusBars.width*a,20),this._spBar.graphics.endFill()},e.prototype.changeMp=function(t,e){this._mpText.text=t+" / "+e;var i=this._nm_background.x+28,n=this.width-i;this._mpText.x=i+n/2-this._spText.width/2,this._mpBar.graphics.clear();var a=parseInt(t)/parseInt(e);this._mpBar.graphics.beginFill(1844134),this._mpBar.graphics.drawRect(0,0,this._statusBars.width*a,20),this._mpBar.graphics.endFill()},e.prototype.update=function(){},e}(egret.DisplayObjectContainer);window.GameHeader=i,__reflect(i.prototype,"GameHeader",[])},function(t,e){var i=function(t){function e(e,i){var n=t.call(this)||this;return n._width=e,n._height=i,n._connection=Connection.instance(),n._logBg=new egret.Shape,n._scrollView=new egret.ScrollView,n.addLogText=function(t,e){var i=new egret.TextField,a=Math.round((n._height-10)/7-3);i.size=a,i.width=n._width-20,i.wordWrap=!0,i.textColor=e,i.text=t,i.x=10,i.y=10,n._scrollContent.$children.forEach(function(t){t.y+=i.height+3}),n._scrollContent.addChild(i)},n.onAddToStage(),n}return __extends(e,t),e.prototype.onAddToStage=function(){var t=this;console.log("constructor"),this._logBg.graphics.lineStyle(1,7303023),this._logBg.graphics.beginFill(331795);var e=this._height;this._logBg.graphics.drawRect(-1,0,this._width+1,e),this._logBg.graphics.endFill(),this.addChild(this._logBg),this._scrollView.width=this._logBg.width,this._scrollView.height=this._logBg.height,this._scrollView.y=this._logBg.y,this.addChild(this._scrollView),this._scrollContent=new egret.DisplayObjectContainer,this._scrollContent.width=this._logBg.width,this._scrollView.setContent(this._scrollContent),this._connection.socket.on("skill",function(e){t.addLogText(e,1091061)}),this._connection.socket.on("stat",function(e){t.addLogText(e,7780891)}),this._connection.socket.on("player-hit",function(e){t.addLogText(e,14680031)}),this._connection.socket.on("enemy-hit",function(e){t.addLogText(e,16768991)}),this._connection.socket.on("news",function(e){t.addLogText(e,7303023)}),this._connection.socket.on("new",function(e){t._scrollContent.removeChildren(),t.addLogText("You started new life as "+e,14671839)})},e}(egret.DisplayObjectContainer);window.GameLog=i,__reflect(i.prototype,"GameLog",[])},function(t,e){var i=function(t){function e(e,i,n){var a=t.call(this)||this;return a.landName=e,a.image=i,a.landId=n,a._grad=new egret.Shape,a._cover=new egret.Shape,a._mask=new egret.Shape,a._connection=Connection.instance(),a.addEventListener(egret.Event.ADDED_TO_STAGE,a.onAddToStage,a),a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,a.onTouch,a),a}return __extends(e,t),e.prototype.onTouch=function(){return"0"===this.landId?void this._connection.socket.emit("other-world"):void this._connection.socket.emit("go-to-land",this.landId)},e.prototype.onAddToStage=function(){this._landBg=this.createBitmapByName(this.image),this._landBg.width=.68*this.width,this._landBg.x=.32*this.width,this._landBg.height=this.height+70,this._landBg.y=-35,this._mask.graphics.beginFill(0),this._mask.graphics.drawRect(0,0,this.width,this.height),this._mask.graphics.endFill(),this.addChild(this._mask),this._landBg.mask=this._mask,this.addChild(this._landBg),this._cover.graphics.beginFill(0),this._cover.graphics.drawRect(0,0,.3*this.width,this.height),this._cover.graphics.endFill(),this.addChild(this._cover),this._grad.graphics.beginGradientFill(egret.GradientType.LINEAR,[0,0,0],[1,1,0],[0,170,255]),this._grad.graphics.drawRect(0,0,255,this.height),this._grad.graphics.endFill(),this._grad.x=.3*this.width,this.addChild(this._grad),this._landText=new egret.TextField,this._landText.size=28,this._landText.text=this.landName,this._landText.textColor=10000536,this._landText.y=this.height/2-this._landText.height/2,this._landText.x=30,this.addChild(this._landText)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);window.Land=i,__reflect(i.prototype,"Land",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._cellSize=e,i._skill1=new egret.Shape,i._skill2=new egret.Shape,i._skill3=new egret.Shape,i._skill4=new egret.Shape,i._skill5=new egret.Shape,i._skill6=new egret.Shape,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.onAddToStage=function(t){this._skill1.graphics.lineStyle(1,7303023),this._skill1.graphics.beginFill(198416),this._skill1.graphics.drawRect(0,0,this._cellSize,this._cellSize),this._skill1.graphics.endFill(),this.addChild(this._skill1),this._skill2.graphics.lineStyle(1,7303023),this._skill2.graphics.beginFill(198416),this._skill2.graphics.drawRect(0,0,this._cellSize,this._cellSize),this._skill2.x=this._skill1.width,this._skill2.graphics.endFill(),this.addChild(this._skill2),this._skill3.graphics.lineStyle(1,7303023),this._skill3.graphics.beginFill(198416),this._skill3.graphics.drawRect(0,0,this._cellSize,this._cellSize),this._skill3.x=this._skill2.x+this._skill2.width,this._skill3.graphics.endFill(),this.addChild(this._skill3),this._skill4.graphics.lineStyle(1,7303023),this._skill4.graphics.beginFill(198416),this._skill4.graphics.drawRect(0,0,this._cellSize,this._cellSize),this._skill4.x=this._skill3.x+this._skill3.width,this._skill4.graphics.endFill(),this.addChild(this._skill4),this._skill5.graphics.lineStyle(1,7303023),this._skill5.graphics.beginFill(198416),this._skill5.graphics.drawRect(0,0,this._cellSize,this._cellSize),this._skill5.x=this._skill4.x+this._skill4.width,this._skill5.graphics.endFill(),this.addChild(this._skill5),this._skill6.graphics.lineStyle(1,7303023),this._skill6.graphics.beginFill(198416),this._skill6.graphics.drawRect(0,0,this._cellSize,this._cellSize),this._skill6.x=this._skill5.x+this._skill5.width,this._skill6.graphics.endFill(),this.addChild(this._skill6)},e}(egret.DisplayObjectContainer);window.SkillBar=i,__reflect(i.prototype,"SkillBar",[])},function(t,e){var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(egret.DisplayObjectContainer);window.StatusBar=i,__reflect(i.prototype,"StatusBar",[])},function(t,e){var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.update=function(){return void{}},e._viewport=A1Viewport.instance(),e}return __extends(e,t),e.prototype.onViewCreated=function(){},e.prototype.onViewStopped=function(){},e.prototype.onRunState=function(){},e.prototype.stop=function(){this._viewport.offResize(this.update),this.onViewStopped()},e.prototype.createView=function(){this._viewport.onResize(this.update),this.onViewCreated()},e.prototype.loadAssets=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.createView(),[2]})})},e}(egret.DisplayObjectContainer);window.A1Scene=i,__reflect(i.prototype,"A1Scene",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i.update=function(){i._text.x=(i._parent.width-i.width)/2,i._text.y=(i._parent.height-i.height)/2},i}return __extends(e,t),e.prototype.onViewCreated=function(){console.log("LOADING_SCENE"),this._text=new egret.TextField,this._text.size=32,this._text.text="Loading... 0/0",this.addChild(this._text),this.update()},e.prototype.onProgress=function(t,e){console.log("LOADING_SCENE: Loading... "+t+"/"+e),this._text.text="Loading... "+t+"/"+e,this.update()},e}(A1Scene);window.A1LoadingScene=i,__reflect(i.prototype,"A1LoadingScene",["RES.PromiseTaskReporter"])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i.update=function(){i._text.x=(i._parent.width-i.width)/2,i._text.y=(i._parent.height-i.height)/2},i.createView(),i.update(),i}return __extends(e,t),e.prototype.onViewCreated=function(){console.log("SPLASH_SCREEN"),this._text=new egret.TextField,this._text.size=32,this._text.text="A1 Core Game",this.addChild(this._text)},e}(A1Scene);window.A1SplashScene=i,__reflect(i.prototype,"A1SplashScene",[])},function(t,e){var i=function(){function t(t){this._container=t,this._scenes=new Map,this._constructors=new Map,this._constructors.set("SPLASH_SCREEN",A1SplashScene),this._constructors.set("LOADING_SCENE",A1LoadingScene)}return t.instance=function(e){return null==t._instance&&null!=e&&(t._instance=new t(e)),t._instance},t.prototype.register=function(t,e){this._constructors.set(t,e)},t.prototype.setState=function(t){return void 0===t&&(t="SPLASH_SCREEN"),__awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return console.log("setState",t),this._state===t?[2,this._currentStateScene]:(this.stopCurrentState(),this._state=t,e=this,[4,this.runState(t)]);case 1:return e._currentStateScene=i.sent(),[2,this._currentStateScene]}})})},t.prototype.update=function(){this._currentStateScene.update()},t.prototype.runState=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return console.log("runState",t),e=this._scenes.get(t),e?(this._container.addChild(e),e.onRunState(),[2,this._scenes.get(t)]):[4,this.createNewScene(t)];case 1:return e=i.sent(),this._container.addChild(e),[2,e]}})})},t.prototype.createNewScene=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return console.log("createNewScene",t),e=this.constructScene(t),"SPLASH_SCREEN"===t?[3,2]:[4,this.loadSceneAssets(e)];case 1:i.sent(),i.label=2;case 2:return[2,e]}})})},t.prototype.loadSceneAssets=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(n){switch(n.label){case 0:return console.log("loadSceneAssets "+this._state),this._scenes.has("LOADING_SCENE")?(i=this._scenes.get("LOADING_SCENE"),[3,3]):[3,1];case 1:return[4,this.createLoadingScene()];case 2:i=n.sent(),n.label=3;case 3:return e=i,this._container.addChild(e),[4,t.loadAssets(e)];case 4:return n.sent(),e.stop(),this._container.removeChild(e),[2]}})})},t.prototype.wait3400=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t,e){setTimeout(function(){t()},0)})]})})},t.prototype.createLoadingScene=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return console.log("createLoadingScene"),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),t=this.constructScene("SPLASH_SCREEN"),this._container.addChild(t),[4,this.wait3400()];case 2:return i.sent(),e=this.constructScene("LOADING_SCENE"),[4,e.loadAssets(void 0)];case 3:return i.sent(),t.stop(),this._container.removeChild(t),[2,e]}})})},t.prototype.constructScene=function(t){console.log("constructScene "+t);var e=this._constructors.get(t),i=new e(this._container);return this._scenes.set(t,i),i},t.prototype.stopCurrentState=function(){console.log("stopCurrentState",this._state),null!=this._currentStateScene&&(this._currentStateScene.stop(),this._container.removeChild(this._currentStateScene))},t}();window.A1State=i,__reflect(i.prototype,"A1State",[])},function(t,e){},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.updateDimentions=function(t){t.ratio<APP_ASPECT_RATIO?this.setThinScreen(t):this.setWideScreen(t),this.updateRectangle()},e.prototype.createView=function(){this._rect=new egret.Shape,this.addChild(this._rect)},e.prototype.updateRectangle=function(){this._rect.graphics.clear(),this._rect.graphics.lineStyle(1,16711680),this._rect.graphics.drawRect(0,0,this.width-2,this.height-2)},e.prototype.setThinScreen=function(t){this.width=t.width,this.height=this.width/APP_ASPECT_RATIO,this.x=0,this.y=(t.height-this.height)/2},e.prototype.setWideScreen=function(t){this.width=t.height*APP_ASPECT_RATIO,this.height=t.height,this.x=(t.width-this.width)/2,this.y=0},e}(egret.DisplayObjectContainer);window.A1AspectScreen=i,__reflect(i.prototype,"A1AspectScreen",["IA1Screen"])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.updateDimentions=function(t){this.width=t.width,this.height=t.height,this.updateRectangle()},e.prototype.createView=function(){this._rect=new egret.Shape,this.addChild(this._rect)},e.prototype.updateRectangle=function(){this._rect.graphics.clear(),this._rect.graphics.lineStyle(0,65280),this._rect.graphics.drawRect(0,0,this.width-2,this.height-2)},e}(egret.DisplayObjectContainer);window.A1FullScreen=i,__reflect(i.prototype,"A1FullScreen",["IA1Screen"])},function(t,e){var i=640;window.APP_CONTENT_WIDTH=i;var n=1136;window.APP_CONTENT_HEIGHT=n;var a=i/n;window.APP_ASPECT_RATIO=a;var r=function(){function t(t){this._stage=t,this._layers=new Map,this._resizeSubscribers=new Set,this._canvas=document.querySelector(".egret-player canvas"),this._stage.addEventListener(egret.Event.RESIZE,this.onStageResize,this),this.onStageResize(),this._viewport=new egret.DisplayObjectContainer,this._stage.addChild(this._viewport)}return t.instance=function(e){return null==t._instance&&null!=e&&(t._instance=new t(e)),t._instance},t.prototype.register=function(t,e){if(this._layers.has(t))return this._layers.get(t);if(null==e)return null;var i=this.createScreenByType(e);return null==i?null:(this._layers.set(t,i),this._viewport.addChild(i),i.updateDimentions(this.windowProps()),i)},t.prototype.toAspectSize=function(t){return t*this._aspectScale},t.prototype.onResize=function(t){this._resizeSubscribers.add(t)},t.prototype.offResize=function(t){this._resizeSubscribers["delete"](t)},t.prototype.notifyResize=function(){this._resizeSubscribers.forEach(function(t){t()})},t.prototype.applyAspectRatio=function(t){this._layers.forEach(function(e){e.updateDimentions(t)})},t.prototype.createScreenByType=function(t){switch(t){case"FullScreen":return new A1FullScreen;case"AspectScreen":return new A1AspectScreen;default:return null}},t.prototype.onStageResize=function(){var t=this.windowProps();
this.updateAspectScale(t),this.applyAspectRatio(t),this.notifyResize()},t.prototype.updateAspectScale=function(t){if(t.ratio<a)return void(this._aspectScale=t.width/i);var e=t.height*a;this._aspectScale=e/i},t.prototype.windowProps=function(){return{width:this._canvas.width/window.devicePixelRatio,height:this._canvas.height/window.devicePixelRatio,ratio:this._canvas.width/this._canvas.height}},t}();window.A1Viewport=r,__reflect(r.prototype,"A1Viewport",[])},function(t,e){},function(t,e){},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i._connection=Connection.instance(),i._state=A1State.instance(),i._titleBar=new egret.Shape,i._title=new egret.TextField,i._rat1bg=new egret.Shape,i._rat2bg=new egret.Shape,i._vs=new egret.TextField,i._rat1HPBarBg=new egret.Shape,i._rat2HPBarBg=new egret.Shape,i._rat1HPBar=new egret.Shape,i._rat2HPBar=new egret.Shape,i._isCreated=!1,i._loadStarted=!1,i._leaveCombatBtnBg=new egret.Shape,i._isAlive=!0,i.onPlayerHp=function(t){var e=t.split("/"),n=parseInt(e[0])/parseInt(e[1]);i._isAlive=parseInt(e[0])>0,i._rat1HPBar.graphics.clear(),i._rat1HPBar.graphics.beginFill(1===n?13373696:9044739),i._rat1HPBar.graphics.drawRect(0,0,i._rat1.width*n,5),i._rat1HPBar.graphics.endFill()},i.onEnemyHp=function(t){var e=t.split("/"),n=parseInt(e[0])/parseInt(e[1]);i._rat2HPBar.graphics.clear(),i._rat2HPBar.graphics.beginFill(1===n?13373696:9044739),i._rat2HPBar.graphics.drawRect(0,0,i._rat1.width*n,5),i._rat2HPBar.graphics.endFill()},i.update=function(){},i}return __extends(e,t),e.prototype.registerListeners=function(){var t=this;this._connection.socket.on("combat-data",function(e){return t._combatInitialData=JSON.parse(e),t._isCreated?(t.onViewStopped(),void t.applyData()):void t.onViewCreated()}),this._connection.sendAction("ask-combat-data")},e.prototype.onViewCreated=function(){var t=this;if(this._loadStarted||(this.registerListeners(),this._loadStarted=!0),!this._isCreated&&this._combatInitialData){console.log("COMBAT_SCENE");var e=Math.round(.15*this._viewport.windowProps().height),i=e>100?100:e,n=this._viewport.windowProps().width;this._titleBar.graphics.lineStyle(1,15724527),this._titleBar.graphics.beginFill(1250067),this._titleBar.graphics.drawRect(0,0,n-1,i/4),this._titleBar.graphics.endFill(),this._titleBar.y=i,this.addChild(this._titleBar),this._title.size=Math.round(.7*this._titleBar.height),this._title.text=this._combatInitialData.isFinished?"Combat Log":"Combat",this._title.textColor=9934743,this._title.y=this._titleBar.y+this._titleBar.height/2-this._title.height/2,this._title.x=this._titleBar.width/2-this._title.width/2,this.addChild(this._title),this._rat1bg.graphics.beginFill(0);var a=.85*n/2,r=a/188;this._rat1bg.graphics.drawRect(0,0,a,138*r),this._rat1bg.graphics.endFill(),this._rat1bg.y=this._titleBar.y+i/2.5+1,this._rat1bg.x=i/8,this.addChild(this._rat1bg),this._rat2bg.graphics.beginFill(0),this._rat2bg.graphics.drawRect(0,0,this._rat1bg.width,this._rat1bg.height),this._rat2bg.graphics.endFill(),this._rat2bg.y=this._rat1bg.y,this._rat2bg.x=n-this._rat1bg.width-i/8,this.addChild(this._rat2bg),this._rat1HPBarBg.graphics.beginFill(3355443),this._rat1HPBarBg.graphics.drawRect(0,0,this._rat1bg.width,5),this._rat1HPBarBg.x=this._rat1bg.x,this._rat1HPBarBg.y=this._rat1bg.y+this._rat1bg.height,this._rat1HPBarBg.graphics.endFill(),this.addChild(this._rat1HPBarBg);var s=this._combatInitialData.rat1HP.split("/"),h=parseInt(s[0])/parseInt(s[1]);this._rat1HPBar.graphics.beginFill(1===h?13373696:9044739),this._rat1HPBar.graphics.drawRect(0,0,this._rat1HPBarBg.width*h,5),this._rat1HPBar.x=this._rat1HPBarBg.x,this._rat1HPBar.y=this._rat1HPBarBg.y,this._rat1HPBar.graphics.endFill(),this.addChild(this._rat1HPBar),this._rat2HPBarBg.graphics.beginFill(3355443),this._rat2HPBarBg.graphics.drawRect(0,0,this._rat1HPBarBg.width,6),this._rat2HPBarBg.x=this._rat2bg.x,this._rat2HPBarBg.y=this._rat1HPBarBg.y,this._rat2HPBarBg.graphics.endFill(),this.addChild(this._rat2HPBarBg);var o=this._combatInitialData.rat2HP.split("/");h=parseInt(o[0])/parseInt(o[1]),this._rat2HPBar.graphics.beginFill(1===h?13373696:9044739),this._rat2HPBar.graphics.drawRect(0,0,this._rat2HPBarBg.width*h,6),this._rat2HPBar.x=this._rat2HPBarBg.x,this._rat2HPBar.y=this._rat2HPBarBg.y,this._rat2HPBar.graphics.endFill(),this.addChild(this._rat2HPBar),this._vs.size=20,this._vs.text="VS",this._vs.textColor=16777215,this._vs.y=this._rat1bg.y+this._rat1bg.height/2-this._vs.height/2+3,this._vs.x=n/2-this._vs.width/2,this.addChild(this._vs),this._connection.socket.on("combat-end",function(e){t.renderLeaveCombatBtn(),t._title.text="Combat Log",t._connection.socket.off("player-hp",t.onPlayerHp),t._connection.socket.off("enemy-hp",t.onEnemyHp)}),this.applyData(),this._isCreated=!0}},e.prototype.applyData=function(){return this._rat1=this.createBitmapByName(this._combatInitialData.rat1Img),this._rat1.y=this._rat1bg.y,this._rat1.x=this._rat1bg.x,this._rat1.width=this._rat1bg.width,this._rat1.height=this._rat1bg.height,this.addChild(this._rat1),this._rat2=this.createBitmapByName(this._combatInitialData.rat2Img),this._rat2.y=this._rat2bg.y,this._rat2.x=this._rat2bg.x,this._rat2.width=this._rat2bg.width,this._rat2.height=this._rat2bg.height,this.addChild(this._rat2),this.onPlayerHp(this._combatInitialData.rat1HP),this.onEnemyHp(this._combatInitialData.rat2HP),this._title.text=this._combatInitialData.isFinished?"Combat Log":"Combat",this._title.x=this._titleBar.width/2-this._title.width/2,this._combatInitialData.isFinished?void(this._leaveCombatBtn||this.renderLeaveCombatBtn()):(this._connection.socket.on("player-hp",this.onPlayerHp),void this._connection.socket.on("enemy-hp",this.onEnemyHp))},e.prototype.renderLeaveCombatBtn=function(){this._leaveCombatBtn=new egret.DisplayObjectContainer,this._leaveCombatBtn.width=this._viewport.windowProps().width-2*this._rat1HPBarBg.x,this._leaveCombatBtn.height=60,this._leaveCombatBtn.y=this._rat1HPBarBg.y+6+3*this._rat1HPBarBg.x,this._leaveCombatBtn.x=this._rat1HPBarBg.x,this._leaveCombatBtnBg.graphics.beginFill(1644825),this._leaveCombatBtnBg.graphics.drawRect(0,0,this._leaveCombatBtn.width,this._leaveCombatBtn.height),this._leaveCombatBtnBg.graphics.endFill(),this._leaveCombatBtn.addChild(this._leaveCombatBtnBg),this._leaveCombatBtnLabel=new egret.TextField,this._leaveCombatBtnLabel.size=28,this._leaveCombatBtnLabel.text=this._isAlive?"Leave Combat":"Release your Soul",this._leaveCombatBtnLabel.textColor=9934743,this._leaveCombatBtnLabel.y=this._leaveCombatBtnBg.y+this._leaveCombatBtnBg.height/2-this._leaveCombatBtnLabel.height/2,this._leaveCombatBtnLabel.x=this._leaveCombatBtnBg.width/2-this._leaveCombatBtnLabel.width/2,this._leaveCombatBtn.addChild(this._leaveCombatBtnLabel),this.addChild(this._leaveCombatBtn),this._leaveCombatBtn.touchEnabled=!0,this._leaveCombatBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.leaveCombat,this)},e.prototype.leaveCombat=function(){this._isAlive?this._connection.sendAction("leave-combat"):this._connection.sendAction("respawn-player")},e.prototype.onRunState=function(){this._connection.sendAction("ask-combat-data")},e.prototype.onViewStopped=function(){this._connection.socket.off("player-hp",this.onPlayerHp),this._connection.socket.off("enemy-hp",this.onEnemyHp),this._leaveCombatBtn&&(this.removeChild(this._leaveCombatBtn),this._leaveCombatBtn=null),this._rat1&&(this.removeChild(this._rat1),this._rat1=null),this._rat2&&(this.removeChild(this._rat2),this._rat2=null)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(A1Scene);window.CombatScene=i,__reflect(i.prototype,"CombatScene",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i._state=A1State.instance(),i._backGroundInitialSize={width:0,height:0},i.update=function(){i.resizeBackground()},i._textures=[],i}return __extends(e,t),e.prototype.loadAssets=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,RES.loadGroup("preload",0,t)];case 1:return i.sent(),console.log("loadSceneAssets DONE"),this.createView(),[3,3];case 2:return e=i.sent(),console.error(e),[3,3];case 3:return[2]}})})},e.prototype.onViewCreated=function(){console.log("HOME_SCENE"),this._backGround=this.createBitmapByName("bg_jpg"),this._backGroundInitialSize.width=this._backGround.width,this._backGroundInitialSize.height=this._backGround.height,this.resizeBackground(),this.addChild(this._backGround)},e.prototype.resizeBackground=function(){var t=this._viewport.toAspectSize(this._backGroundInitialSize.width);this._viewport.toAspectSize(this._backGroundInitialSize.height);if(this._parent.width>t){this._backGround.width=this._parent.width,this._backGround.height=this._backGroundInitialSize.height*(this._parent.width/this._backGroundInitialSize.width);var e=this._backGround.height-this._parent.height;this._backGround.x=0,this._backGround.y=-(e/2)}else{this._backGround.height=this._parent.height,this._backGround.width=this._backGroundInitialSize.width*(this._parent.height/this._backGroundInitialSize.height);var i=this._backGround.width-this._parent.width;this._backGround.y=0,this._backGround.x=-(i/2)}},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return this._textures.push(i),e.texture=i,e},e}(A1Scene);window.HomeScene=i,__reflect(i.prototype,"HomeScene",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i._connection=Connection.instance(),i._titleBar=new egret.Shape,i._title=new egret.TextField,i._landsScrollView=new egret.ScrollView,i._leaveLandBtnBg=new egret.Shape,i._loadStarted=!1,i._isCreated=!1,i.registerListeners=function(){i._connection.socket.on("land-data",function(t){return i._landInitialData=JSON.parse(t),i._isCreated?(i.onViewStopped(),void i.applyData()):void i.onViewCreated()}),i._connection.sendAction("ask-land-data")},i.leaveLand=function(){i._connection.socket.emit("leave-land")},i.update=function(){},i}return __extends(e,t),e.prototype.onViewCreated=function(){var t=this;if(this._loadStarted||(this.registerListeners(),this._loadStarted=!0),!this._isCreated&&this._landInitialData){console.log("LAND_SCENE");var e=Math.round(.15*this._viewport.windowProps().height),i=e>100?100:e;this._titleBar.graphics.lineStyle(1,15724527),this._titleBar.graphics.beginFill(1250067),this._titleBar.graphics.drawRect(0,0,this._viewport.windowProps().width-1,i/4),this._titleBar.graphics.endFill(),this._titleBar.y=i,this.addChild(this._titleBar),this._title.size=Math.round(.7*this._titleBar.height),this._title.text="Undefined Land",this._title.textColor=9934743,this._title.y=this._titleBar.y+this._titleBar.height/2-this._title.height/2,this.addChild(this._title),this._landsScrollView.width=this._viewport.windowProps().width,this._landsScrollView.height=this._parent.getChildByName("gameLog").y-i-i/4-1,this._landsScrollView.y=i+i/4+1,this.addChild(this._landsScrollView),this._landsScrollContent=new egret.DisplayObjectContainer,this._landsScrollContent.width=this._viewport.windowProps().width,this._landsScrollView.setContent(this._landsScrollContent),this.applyData(),this._connection.socket.on("land-update",function(e){t.onRunState()}),this._isCreated=!0}},e.prototype.onRunState=function(){this._connection.sendAction("ask-land-data")},e.prototype.onViewStopped=function(){this._leaveLandBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.leaveLand,this),this._landsScrollView.scrollTop=0,this._landsScrollContent.removeChildren()},e.prototype.applyData=function(){var t=this;this._title.text=this._landInitialData.name,this._title.x=this._titleBar.width/2-this._title.width/2;var e;if(0===this._landInitialData.rats.length){this._landImage=this.createBitmapByName(this._landInitialData.image);var i=this._viewport.windowProps().width,n=i/this._landImage.width;this._landImage.width=i,this._landImage.height=this._landImage.height*n*.7,this._landsScrollContent.addChild(this._landImage),e=this._landImage}else this._landInitialData.rats.forEach(function(i){var n=new Creature(i.name,i.image,i.id,i.hp);n.width=t._viewport.windowProps().width-30,n.height=60,n.x=15,e?n.y=e.y+e.height+15:n.y=15,e=n,t._landsScrollContent.addChild(n)});this._leaveLandBtn=new egret.DisplayObjectContainer,this._leaveLandBtn.width=this._viewport.windowProps().width-30,this._leaveLandBtn.height=60,this._leaveLandBtn.y=e.y+e.height+15,this._leaveLandBtn.x=15,this._leaveLandBtnBg.graphics.beginFill(1644825),this._leaveLandBtnBg.graphics.drawRect(0,0,this._leaveLandBtn.width,this._leaveLandBtn.height),this._leaveLandBtnBg.graphics.endFill(),this._leaveLandBtn.addChild(this._leaveLandBtnBg),this._leaveLandBtnLabel=new egret.TextField,this._leaveLandBtnLabel.size=28,this._leaveLandBtnLabel.text="Leave Land",this._leaveLandBtnLabel.textColor=9934743,this._leaveLandBtnLabel.y=this._leaveLandBtnBg.y+this._leaveLandBtnBg.height/2-this._leaveLandBtnLabel.height/2,this._leaveLandBtnLabel.x=this._leaveLandBtnBg.width/2-this._leaveLandBtnLabel.width/2,this._leaveLandBtn.addChild(this._leaveLandBtnLabel),this._landsScrollContent.addChild(this._leaveLandBtn),this._leaveLandBtn.touchEnabled=!0,this._leaveLandBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.leaveLand,this),this._landsScrollContent.height=75*this._landInitialData.rats.length+15+75},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(A1Scene);window.LandScene=i,__reflect(i.prototype,"LandScene",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i._connection=Connection.instance(),i._state=A1State.instance(),i.handleInitialData=function(t){i.onPlayerInitialData(JSON.parse(t)),i._connection.socket.off("player-data",i.handleInitialData),i._connection.socket.emit("update-on-location")},i.update=function(){i._text.x=(i._parent.width-i.width)/2,i._text.y=(i._parent.height-i.height)/2},i}return __extends(e,t),e.prototype.loadAssets=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,RES.loadGroup("preload",0,t)];case 1:return i.sent(),console.log("loadSceneAssets DONE"),this.createView(),this.update(),[3,3];case 2:return e=i.sent(),console.error(e),[3,3];case 3:return[2]}})})},e.prototype.onPlayerInitialData=function(t){var e=this._viewport.windowProps(),i=new GameHeader(t,e);this._parent.addChild(i);var n=e.width/6-1;console.log(e.width/6,e.height/(e.width/6));var a=new SkillBar(n);a.y=e.height-n,this._parent.addChild(a);var r=i.height,s=new GameLog(e.width,r);s.name="gameLog",s.y=e.height-n-r,this._parent.addChild(s)},e.prototype.onViewCreated=function(){var t=this;console.log("SPLASH_SCENE"),this._text=new egret.TextField,this._text.size=32,this._text.text="A1 Core Game",this.addChild(this._text),this._connection.sendAction("ask-player-data"),this._connection.socket.on("player-data",this.handleInitialData),this._connection.socket.on("change-to-land",function(){t._state.setState("LAND_SCENE")}),this._connection.socket.on("change-to-world",function(){t._state.setState("WORLD_SCENE")}),this._connection.socket.on("change-to-combat",function(){console.log("change-to-combat"),t._state.setState("COMBAT_SCENE")})},e}(A1Scene);window.SplashScene=i,__reflect(i.prototype,"SplashScene",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i._connection=Connection.instance(),i._titleBar=new egret.Shape,i._title=new egret.TextField,i._landsScrollView=new egret.ScrollView,i._isCreated=!1,i.update=function(){},i._connection.socket.on("world-data",function(t){return i._worldInitialData=JSON.parse(t),i._isCreated?void i.applyData():void i.onViewCreated()}),i._connection.sendAction("ask-world-data"),i}return __extends(e,t),e.prototype.onViewCreated=function(){if(!this._isCreated&&this._worldInitialData){console.log("WORLD_SCENE");var t=Math.round(.15*this._viewport.windowProps().height),e=t>100?100:t,i=this._viewport.windowProps().width;this._titleBar.graphics.lineStyle(1,15724527),this._titleBar.graphics.beginFill(1250067),this._titleBar.graphics.drawRect(0,0,i-1,e/4),this._titleBar.graphics.endFill(),this._titleBar.y=e,this.addChild(this._titleBar),this._title.size=Math.round(.7*this._titleBar.height),this._title.text=this._worldInitialData.name,this._title.textColor=9934743,this._title.y=this._titleBar.y+this._titleBar.height/2-this._title.height/2,this.addChild(this._title),this._landsScrollView.width=this._viewport.windowProps().width,this._landsScrollView.height=this._parent.getChildByName("gameLog").y-e-e/4-1,this._landsScrollView.y=e+e/4+1,this.addChild(this._landsScrollView),this._landsScrollContent=new egret.DisplayObjectContainer,this._landsScrollContent.width=this._viewport.windowProps().width,this._landsScrollView.setContent(this._landsScrollContent),this.onRunState(),this._isCreated=!0}},e.prototype.onRunState=function(){this._connection.sendAction("ask-world-data")},e.prototype.onViewStopped=function(){this._landsScrollView.scrollTop=0,this._landsScrollContent.removeChildren()},e.prototype.applyData=function(){var t=this;this.onViewStopped(),this._title.text=this._worldInitialData.name,this._title.x=this._titleBar.width/2-this._title.width/2;var e;this._worldInitialData.lands.push({name:"Other World",image:"portal_png",id:"0"}),this._worldInitialData.lands.forEach(function(i){var n=new Land(i.name,i.image,i.id);n.width=t._viewport.windowProps().width-30,n.height=60,n.x=15,e?n.y=e.y+e.height+15:n.y=15,e=n,t._landsScrollContent.addChild(n)}),this._landsScrollContent.height=75*this._worldInitialData.lands.length+15},e}(A1Scene);window.WorldScene=i,__reflect(i.prototype,"WorldScene",[])}]);