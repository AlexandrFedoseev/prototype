var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},__extends=function(t,e){function i(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},__assign=Object.assign||function(t){for(var e,i=1,a=arguments.length;a>i;i++){e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},__rest=function(t,e){var i={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(i[a]=t[a]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,a=Object.getOwnPropertySymbols(t);s<a.length;s++)e.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(t,a[s])&&(i[a[s]]=t[a[s]]);return i},__decorate=function(t,e,i,a){var s,n=arguments.length,r=3>n?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,a);else for(var h=t.length-1;h>=0;h--)(s=t[h])&&(r=(3>n?s(r):n>3?s(e,i,r):s(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r},__param=function(t,e){return function(i,a){e(i,a,t)}},__metadata=function(t,e){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(t,e):void 0},__awaiter=function(t,e,i,a){function s(t){return t instanceof i?t:new i(function(e){e(t)})}return new(i||(i=Promise))(function(i,n){function r(t){try{o(a.next(t))}catch(e){n(e)}}function h(t){try{o(a["throw"](t))}catch(e){n(e)}}function o(t){t.done?i(t.value):s(t.value).then(r,h)}o((a=a.apply(t,e||[])).next())})},__generator=function(t,e){function i(t){return function(e){return a([t,e])}}function a(i){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,n&&(r=2&i[0]?n["return"]:i[0]?n["throw"]||((r=n["return"])&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(r=o.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(a){i=[6,a],n=0}finally{s=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,n,r,h,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return h={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},__exportStar=function(t,e){for(var i in t)"default"===i||e.hasOwnProperty(i)||__createBinding(e,t,i)},__createBinding=Object.create?function(t,e,i,a){void 0===a&&(a=i),Object.defineProperty(t,a,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,a){void 0===a&&(a=i),t[a]=e[i]},__values=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],a=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var a,s,n=i.call(t),r=[];try{for(;(void 0===e||e-->0)&&!(a=n.next()).done;)r.push(a.value)}catch(h){s={error:h}}finally{try{a&&!a.done&&(i=n["return"])&&i.call(n)}finally{if(s)throw s.error}}return r},__spread=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t},__spreadArrays=function(){for(var t=0,e=0,i=arguments.length;i>e;e++)t+=arguments[e].length;for(var a=Array(t),s=0,e=0;i>e;e++)for(var n=arguments[e],r=0,h=n.length;h>r;r++,s++)a[s]=n[r];return a},__await=function(t){return this instanceof __await?(this.v=t,this):new __await(t)},__asyncGenerator=function(t,e,i){function a(t){d[t]&&(l[t]=function(e){return new Promise(function(i,a){_.push([t,e,i,a])>1||s(t,e)})})}function s(t,e){try{n(d[t](e))}catch(i){o(_[0][3],i)}}function n(t){t.value instanceof __await?Promise.resolve(t.value.v).then(r,h):o(_[0][2],t)}function r(t){s("next",t)}function h(t){s("throw",t)}function o(t,e){t(e),_.shift(),_.length&&s(_[0][0],_[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,d=i.apply(t,e||[]),_=[];return l={},a("next"),a("throw"),a("return"),l[Symbol.asyncIterator]=function(){return this},l},__asyncDelegator=function(t){function e(e,s){i[e]=t[e]?function(i){return(a=!a)?{value:__await(t[e](i)),done:"return"===e}:s?s(i):i}:s}var i,a;return i={},e("next"),e("throw",function(t){throw t}),e("return"),i[Symbol.iterator]=function(){return this},i},__asyncValues=function(t){function e(e){a[e]=t[e]&&function(a){return new Promise(function(s,n){a=t[e](a),i(s,n,a.done,a.value)})}}function i(t,e,i,a){Promise.resolve(a).then(function(e){t({value:e,done:i})},e)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,s=t[Symbol.asyncIterator];return s?s.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),a={},e("next"),e("throw"),e("return"),a[Symbol.asyncIterator]=function(){return this},a)},__makeTemplateObject=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},__setModuleDefault=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t["default"]=e},__importStar=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&__createBinding(e,t,i);return __setModuleDefault(e,t),e},__importDefault=function(t){return t&&t.__esModule?t:{"default":t}},__classPrivateFieldGet=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)},__classPrivateFieldSet=function(t,e,i){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,i),i},__reflect=function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i};!function(t){function e(a){if(i[a])return i[a].exports;var s=i[a]={i:a,l:!1,exports:{}};return t[a].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,a){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:a})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(e.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(a,s,function(e){return t[e]}.bind(null,s));return a},e.n=function(t){var i=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){i(1),i(2),i(3),i(4),i(5),i(6),i(7),i(8),i(9),i(10),i(11),i(12),i(13),i(14),i(15),i(16),i(17),i(18),i(19),i(20),i(21),i(22),i(23),i(24),i(25);var a=function(t){function e(){var e=t.call(this)||this;return e._connection=Connection.instance(),e._prod="https://prototype-ws.herokuapp.com",e._dev="http://localhost:9000",e._origin=e._prod,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return console.log("RUN GAME"),this._viewport=A1Viewport.instance(this.stage),this._mainView=this._viewport.register("MAIN_VIEW","FullScreen"),this._state=A1State.instance(this._mainView),this._state.register("HOME",HomeScene),this._state.register("SPLASH_SCENE",SplashScene),this._state.register("GAME_SCENE",GameScene),(t=localStorage.getItem("proto_user_id"))?(this._connection.connect(this._origin,t),[3,3]):[3,1];case 1:return[4,this._state.setState("HOME")];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e}(egret.DisplayObjectContainer);window.Main=a,__reflect(a.prototype,"Main",[])},function(t,e){var i=function(){function t(){var t=this;this.onInitialData=function(){},this.connect=function(e,i){console.log("SOCKET"),t.socket=io.connect(e),t.socket.emit("request-auth",i),t.socket.on("message",function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return null!=e.path?[3,2]:(this.initialData=e,console.log(this.initialData),this.onInitialData(),[4,A1State.instance().setState("SPLASH_SCENE")]);case 1:t.sent(),t.label=2;case 2:return[2]}})})})}}return t.instance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.sendAction=function(t){this.socket.emit(t)},t._instance=null,t}();window.Connection=i,__reflect(i.prototype,"Connection",[])},function(t,e){var i=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();window.DebugPlatform=i,__reflect(i.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new i)},function(t,e){var i=function(t){function e(e,i,a,s,n,r){void 0===s&&(s=1),void 0===n&&(n=[]),void 0===r&&(r="n");var h=t.call(this)||this;return h.creatureName=e,h.creatureID=i,h.image=a,h.ratio=s,h.effects=n,h.mode=r,h._combatHighlight=new egret.Shape,h._cover=new egret.Shape,h._mask=new egret.Shape,h._connection=Connection.instance(),h._rat1HPBarBg=new egret.Shape,h._rat1HPBar=new egret.Shape,h._effects=new egret.DisplayObjectContainer,h.onRemoveFromStage=function(){h._connection.socket.off(h.creatureID,h.onCreatureId)},h.applyEffects=function(){h._effects.removeChildren();var t;h.effects.forEach(function(e){var i=h.createBitmapByName(e.image);i.width=40,i.height=40,i.scaleY=.5,i.scaleX=.5,h._effects.addChild(i),i.x=t?t.x+20+2:0,t=i})},h.onCreatureId=function(t){t.path&&"hp"==t.path[0]&&h.updateHPBar(t.content),t.path&&"mode"==t.path[0]&&h.setMode(t.content),t.path&&"effects"==t.path[0]&&(t.content.name?h.effects.push(t.content):h.effects=h.effects.filter(function(e){return e.name!==t.content}),h.applyEffects())},h.addEventListener(egret.Event.ADDED_TO_STAGE,h.onAddToStage,h),h.addEventListener(egret.Event.REMOVED_FROM_STAGE,h.onRemoveFromStage,h),h.touchEnabled=!0,h.addEventListener(egret.TouchEvent.TOUCH_TAP,h.onTouch,h),h}return __extends(e,t),e.prototype.onTouch=function(){this._connection.socket.emit("a",{a:"attack",p:this.creatureID})},e.prototype.onAddToStage=function(){this._cover.graphics.beginFill(0),this._cover.graphics.drawRect(0,0,this.width,this.height-20),this._cover.y=10,this._cover.graphics.endFill(),this.addChild(this._cover),this._cImage=this.createBitmapByName(this.image);var t=224/this._cImage.width;this._cImage.width=224,this._cImage.scaleX=.5,this._cImage.scaleY=.5,this._cImage.height=this._cImage.height*t,this._cImage.y=this.height/2-this._cImage.height/4,this._cImage.x=-this._cImage.width/10,this._mask.graphics.beginFill(0),this._mask.graphics.drawCircle(0,0,this._cImage.height/2),this._mask.x=this._cImage.x+this._cImage.width/4,this._mask.y=this._cImage.y+this._cImage.height/4,this._mask.scaleX=.5,this._mask.scaleY=.5,this._mask.graphics.endFill(),this.addChild(this._mask),this._cImage.mask=this._mask,this.addChild(this._cImage),this.addChild(this._combatHighlight),this.setMode(this.mode),this._cName=new egret.TextField,this._cName.size=14,this._cName.text=this.creatureName,this._cName.textColor=16711422,this._cName.y=this.height/2-this._cName.height/2,this._cName.x=this._mask.width/4+this._mask.x+20,this.addChild(this._cName),this._rat1HPBarBg.graphics.beginFill(3355443),this._rat1HPBarBg.graphics.drawRect(0,0,this._cover.width-this._cName.x+10,5),this._rat1HPBarBg.x=this._cName.x-10,this._rat1HPBarBg.y=this._cover.y+this._cover.height,this._rat1HPBarBg.graphics.endFill(),this.addChild(this._rat1HPBarBg);var e=1;this._rat1HPBar.graphics.beginFill(1===e?13373696:9044739),this._rat1HPBar.graphics.drawRect(0,0,this._rat1HPBarBg.width*e,5),this._rat1HPBar.x=this._rat1HPBarBg.x,this._rat1HPBar.y=this._rat1HPBarBg.y,this._rat1HPBar.graphics.endFill(),this.addChild(this._rat1HPBar),this.addChild(this._effects),this._effects.y=this._cName.y-22,this._effects.x=this._cName.x,this.updateHPBar(this.ratio),this.applyEffects(),this._connection.socket.on(this.creatureID,this.onCreatureId)},e.prototype.setMode=function(t){"n"===t?this._combatHighlight.visible=!1:(this._combatHighlight.graphics.clear(),this._combatHighlight.graphics.lineStyle(2,"a"===t?13241088:12533503),this._combatHighlight.graphics.drawCircle(this._mask.x,this._mask.y,this._cImage.height/4),this._combatHighlight.visible=!0)},e.prototype.updateHPBar=function(t){this._rat1HPBar.graphics.clear(),this._rat1HPBar.graphics.beginFill(1===t?13373696:9044739),this._rat1HPBar.graphics.drawRect(0,0,this._rat1HPBarBg.width*t,5),this._rat1HPBar.graphics.endFill()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);window.Creature=i,__reflect(i.prototype,"Creature",[])},function(t,e){var i=function(t){function e(e,i){var a=t.call(this)||this;return a._window=e,a._parent=i,a._connection=Connection.instance(),a._background=new egret.Shape,a._sb_background=new egret.Shape,a._nm_background=new egret.Shape,a._hpBar=new egret.Shape,a._spBar=new egret.Shape,a._fpBar=new egret.Shape,a._statusBars=new egret.DisplayObjectContainer,a._circle=new egret.Shape,a._hpBack=new egret.Shape,a._fpBack=new egret.Shape,a._spBack=new egret.Shape,a._effects=new egret.DisplayObjectContainer,a._barHeight=20,a.isUpdate=!1,a.updateBars=function(){var t=a.followBar(a._hpBack,a.getMaxBarValue(),a._data.bars.maxHp,a._data.bars.hp),e=a.followBar(a._fpBack,a.getMaxBarValue(),a._data.bars.maxMp,a._data.bars.mp),i=a.followBar(a._spBack,a.getMaxBarValue(),a._data.bars.maxSp,a._data.bars.sp);return t&&e&&i?void(a.isUpdate=!1):(a.isUpdate=!0,void setTimeout(function(){a.updateBars()},25))},a.applyEffects=function(){a._effects.removeChildren();var t;a._data.effects.forEach(function(e){var i=a.createBitmapByName(e.image);i.width=40,i.height=40,i.scaleY=.5,i.scaleX=.5,a._effects.addChild(i),i.x=t?t.x+20+5:0,t=i})},a._upTimeout=null,a._data=a._connection.initialData.character,a.addEventListener(egret.Event.ADDED_TO_STAGE,a.onAddToStage,a),a._connection.socket.on("character",function(t){if(0===t.path.length){a._data=t.content,a.renderPlayerImage(),a.applyEffects(),a._name.text=a._data.name,a._name.x=a._nm_background.x+(a.width-a._nm_background.x)/2-a._name.width/2;var e=a.getMaxBarValue();a.renderBackBar(a._hpBack,e,a._data.bars.maxHp,a._data.bars.hp),a.renderBackBar(a._fpBack,e,a._data.bars.maxMp,a._data.bars.mp),a.renderBackBar(a._spBack,e,a._data.bars.maxSp,a._data.bars.sp),a.changeHp(a._data.bars.hp,a._data.bars.maxHp),a.changeSp(a._data.bars.sp,a._data.bars.maxSp),a.changeMp(a._data.bars.mp,a._data.bars.maxMp)}if("effects"===t.path[0]&&(t.content.hasOwnProperty("name")?a._data.effects.push(t.content):a._data.effects=a._data.effects.filter(function(e){return e.name!==t.content}),a.applyEffects()),"hp"===t.path[1]&&(a._data.bars[t.path[1]]=t.content,a.changeHp(a._data.bars.hp,a._data.bars.maxHp)),"sp"===t.path[1]&&(a._data.bars[t.path[1]]=t.content,a.changeSp(a._data.bars.sp,a._data.bars.maxSp)),"mp"===t.path[1]&&(a._data.bars[t.path[1]]=t.content,a.changeMp(a._data.bars.mp,a._data.bars.maxMp)),"maxHp"===t.path[1]||"maxSp"===t.path[1]||"maxMp"===t.path[1]){var i="maxHp"===t.path[1]&&a._data.bars[t.path[1]]>t.content;a._data.bars[t.path[1]]=t.content,a.changeHp(a._data.bars.hp,a._data.bars.maxHp),i&&a.renderBackBar(a._hpBack,a.getMaxBarValue(),a._data.bars.maxHp,a._data.bars.hp),a.changeSp(a._data.bars.sp,a._data.bars.maxSp),a.changeMp(a._data.bars.mp,a._data.bars.maxMp)}}),a}return __extends(e,t),e.prototype.onAddToStage=function(){var t=Math.round(.15*this._window.height);this.height=t>100?100:t,this.width=this._window.width,this._background.graphics.beginFill(0,.1),this._background.graphics.drawRect(0,0,this.width,this.height),this._background.graphics.endFill(),this.addChild(this._background),this.renderPlayerImage(),this.applyEffects(),this.addChild(this._circle);var e=Math.round(3*this.height/7);this._sb_background.graphics.drawRect(0,0,this.width-this._circle.width-13,e),this._statusBars.addChild(this._sb_background),this._statusBars.x=this._circle.width+3,this._statusBars.y=Math.round(.4*(this.height-e)),this.addChild(this._statusBars),this._nm_background.graphics.beginFill(0,.1),this._nm_background.graphics.lineStyle(1,7303023,.1),this._nm_background.graphics.drawRect(0,0,this.width-this._circle.width-2,this._statusBars.y),this._nm_background.x=this._circle.width,this._nm_background.graphics.endFill(),this.addChild(this._nm_background),this._name=new egret.TextField,this._name.size=Math.round(.8*this._nm_background.height),this._name.text=this._data.name,this._name.x=this._nm_background.x+(this.width-this._nm_background.x)/2-this._name.width/2,this._name.y=1+this._nm_background.height/2-this._name.height/2,this.addChild(this._name);var i=Math.round(.24*this._sb_background.height/4);this._barHeight=Math.round((this._sb_background.height-4*i)/3),i-=1;var a=this.getMaxBarValue();this.renderBar(4988958,this._hpBar,a,this._data.bars.maxHp,this._data.bars.hp),this.renderBackBar(this._hpBack,a,this._data.bars.maxHp,this._data.bars.hp),this._hpBar.y=i,this._hpBack.y=this._hpBar.y,this._statusBars.addChild(this._hpBack),this._statusBars.addChild(this._hpBar),this.renderBar(2368080,this._fpBar,a,this._data.bars.maxMp,this._data.bars.mp),this.renderBackBar(this._fpBack,a,this._data.bars.maxMp,this._data.bars.mp),this._fpBar.y=this._hpBar.y+this._hpBar.height+i,this._fpBack.y=this._fpBar.y,this._statusBars.addChild(this._fpBack),this._statusBars.addChild(this._fpBar),this.renderBar(3428659,this._spBar,a,this._data.bars.maxSp,this._data.bars.sp),this.renderBackBar(this._spBack,a,this._data.bars.maxSp,this._data.bars.sp),this._spBar.y=this._fpBar.y+this._fpBar.height+i,this._spBack.y=this._spBar.y,this._statusBars.addChild(this._spBack),this._statusBars.addChild(this._spBar);var s=this._statusBars.y+this._statusBars.height;this.addChild(this._effects),this._effects.x=this._nm_background.x,this._effects.y=s+7,this.updateBars()},e.prototype.renderBackBar=function(t,e,i,a){a=a>i?i:a;var s=i/e,n=s*this._sb_background.width,r=t.x+n-2,h=a/i;t.graphics.clear(),t.graphics.beginFill(15394721,.18),t.graphics.drawRect(t.x+2,3,r*h,this._barHeight-2),t.graphics.endFill()},e.prototype.followBar=function(t,e,i,a){var s=i/e,n=s*this._sb_background.width,r=t.x+n-2<0?0:t.x+n-2,h=0==i?1:a/i,o=r*h;if(o===t.width)return!0;var l=o<t.width?t.width-1:o;return t.graphics.clear(),t.graphics.beginFill(15394721,.18),t.graphics.drawRect(t.x+2,3,l,this._barHeight-2),t.graphics.endFill(),!1},e.prototype.renderBar=function(t,e,i,a,s){var n=a/i,r=n*this._sb_background.width;e.graphics.clear(),e.graphics.lineStyle(2,16777215,.3),e.graphics.moveTo(e.x-2,2),e.graphics.lineTo(e.x+r+3,2),e.graphics.moveTo(e.x-2,2+this._barHeight),e.graphics.lineTo(e.x+r+6,2+this._barHeight),e.graphics.lineStyle(0),e.graphics.beginFill(16777215,.1),e.graphics.drawRect(e.x+1,3,e.x+r,this._barHeight-2),e.graphics.endFill(),e.graphics.beginFill(t);var h=e.x+r-2<0?0:e.x+r-2,o=0==a?1:s/a;e.graphics.drawRect(e.x+2,3,h*o,this._barHeight-2),e.graphics.endFill(),e.graphics.moveTo(e.x+3,3),e.graphics.lineStyle(3,16777215,.1),e.graphics.lineTo(h,3),e.graphics.moveTo(e.x+2,this._barHeight),e.graphics.lineStyle(1,0,.15),e.graphics.lineTo(h+1,this._barHeight),e.graphics.lineStyle(2,16777215,.15),e.graphics.moveTo(h*o+2,3),e.graphics.lineTo(h*o+2,this._barHeight)},e.prototype.renderPlayerImage=function(){if(this._rat1)this._rat1.texture=RES.getRes(this._data.image);else{this._rat1=this.createBitmapByName(this._data.image);var t=2*this.height/this._rat1.height;this._rat1.height=2*this.height,this._rat1.width=this._rat1.width*t,this._rat1.x=0-(this._rat1.width-this._rat1.height)/2,this._rat1.scaleX=.5,this._rat1.scaleY=.5,this.addChild(this._rat1),this._circle.graphics.clear(),this._circle.graphics.beginFill(65280),this._circle.graphics.drawCircle(0,0,this._rat1.height/4),this._circle.graphics.endFill(),this._circle.x=this._rat1.height/4,this._circle.y=this._rat1.height/4,this._rat1.mask=this._circle,this._rat1.touchEnabled=!0,this._rat1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStatsTap,this)}},e.prototype.onToggleLeader=function(){this._connection.socket.emit("toggle-leader")},e.prototype.onStatsTap=function(){var t=this._parent.getChildByName("statsScreen");t.toggleVisible()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.getMaxBarValue=function(){var t=this._data.effects.some(function(t){return"divine_blessing"===t.name})?1:1.3,e=this._data.bars.maxHp*t>this._data.bars.maxSp?this._data.bars.maxHp*t:this._data.bars.maxSp;return e>this._data.bars.maxMp?e:this._data.bars.maxMp},e.prototype.checkUpdateNeeded=function(){var t=this;this.isUpdate||(this._upTimeout&&clearTimeout(this._upTimeout),this._upTimeout=setTimeout(function(){t._upTimeout=null,t.updateBars()},500))},e.prototype.changeHp=function(t,e){var i=this.getMaxBarValue();this.renderBar(4988958,this._hpBar,i,e,t),this.checkUpdateNeeded()},e.prototype.changeSp=function(t,e){var i=this.getMaxBarValue();this.renderBar(3428659,this._spBar,i,e,t),this.checkUpdateNeeded()},e.prototype.changeMp=function(t,e){var i=this.getMaxBarValue();this.renderBar(2368080,this._fpBar,i,e,t),this.checkUpdateNeeded()},e.prototype.update=function(){},e}(egret.DisplayObjectContainer);window.GameHeader=i,__reflect(i.prototype,"GameHeader",[])},function(t,e){var i=function(t){function e(e,i,a){var s=t.call(this)||this;return s._vp=e,s._height=i,s._headerHeight=a,s._connection=Connection.instance(),s._logBg=new egret.Shape,s._scrollView=new egret.ScrollView,s._c={m:16542853,es:15906823,me:12517631,mh:14679808,g:14204888,p:14680031,e:16760767,n:7303023,sk:1091061,st:7780891},s._fontsize=18,s._isExpanded=!1,s.addLogText=function(t,e){var i;s._scrollContent.$children.length<64?i=new egret.TextField:(i=s._scrollContent.$children[0],s._scrollContent.removeChild(i)),i.size=s._fontsize,i.width=s._logBg.width-20,i.wordWrap=!0,i.textColor=e,i.text=t,i.x=10,i.y=10,s._scrollContent.$children.forEach(function(t){t.y+=i.height+3}),s._scrollContent.addChild(i)},s.addEventListener(egret.Event.ADDED_TO_STAGE,s.onAddToStage,s),s._data=s._connection.initialData.logs,s}return __extends(e,t),e.prototype.onAddToStage=function(){var t=this;this._logBg.graphics.lineStyle(1,7303023),this._logBg.graphics.beginFill(331795);var e=this._height;this._logBg.graphics.drawRect(0,0,this._vp.width-1,e),this._logBg.graphics.endFill(),this._logBg.x=0,this.addChild(this._logBg),this._fontsize=Math.round((this._logBg.height-10)/6-3),this._scrollView.width=this._logBg.width,this._scrollView.height=this._logBg.height,this._scrollView.y=this._logBg.y,this._scrollView.x=this._logBg.x,this.addChild(this._scrollView),this._scrollContent=new egret.DisplayObjectContainer,this._scrollContent.width=this._logBg.width,this._scrollView.setContent(this._scrollContent),this._data.forEach(function(e){t.addLogText(e.msg,t._c[e.t])}),this._connection.socket.on("log",function(e){t.addLogText(e.msg,t._c[e.t])})},e.prototype.setHeight=function(t){this._isExpanded=!!t,this._logBg.graphics.clear(),this._logBg.graphics.lineStyle(1,7303023),this._logBg.graphics.beginFill(331795);var e=null==t?this._height:t;this._logBg.graphics.drawRect(-1,0,this._vp.width+1,e),this._logBg.graphics.endFill(),this._scrollView.y=this._logBg.y,this._scrollView.height=this._logBg.height,this.y=this.parent.getChildByName("skills").y-this._logBg.height},e}(egret.DisplayObjectContainer);window.GameLog=i,__reflect(i.prototype,"GameLog",[])},function(t,e){var i=function(t){function e(e,i,a,s){void 0===s&&(s="land");var n=t.call(this)||this;return n.landName=e,n.image=i,n.landId=a,n.action=s,n._grad=new egret.Shape,n._cover=new egret.Shape,n._mask=new egret.Shape,n._connection=Connection.instance(),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouch,n),n}return __extends(e,t),e.prototype.onTouch=function(){this._connection.socket.emit("a",{a:this.action,p:this.landId})},e.prototype.onAddToStage=function(){this._landBg=this.createBitmapByName(this.image);var t=.6*this.width*2/this._landBg.width;this._landBg.width=.75*this.width*2,this._landBg.x=.25*this.width,this._landBg.height=t*this._landBg.height,this._landBg.y=this.height/2-this._landBg.height/4,this._landBg.scaleX=.5,this._landBg.scaleY=.5,this._mask.graphics.beginFill(0),this._mask.graphics.drawRect(0,0,this.width,this.height),this._mask.graphics.endFill(),this.addChild(this._mask),this._landBg.mask=this._mask,this.addChild(this._landBg),this._cover.graphics.beginFill(0),this._cover.graphics.drawRect(0,0,.25*this.width,this.height),this._cover.graphics.endFill(),this.addChild(this._cover);var e=new egret.Matrix;e.createGradientBox(.25*this.width,this.height,0),this._grad.graphics.beginGradientFill(egret.GradientType.LINEAR,[0,0],[1,0],[0,255],e),this._grad.graphics.drawRect(0,0,.25*this.width,this.height+1),this._grad.graphics.endFill(),this._grad.y=-.5,this._grad.x=this._cover.width,this.addChild(this._grad),this._landText=new egret.TextField,this._landText.size=20,this._landText.text=this.landName,this._landText.textColor=10000536,this._landText.y=this.height/2-this._landText.height/2,this._landText.x=30,this.addChild(this._landText)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);window.Land=i,__reflect(i.prototype,"Land",[])},function(t,e){var i=function(t){function e(e,i,a){var s=t.call(this)||this;return s._width=e,s._height=i,s._window=a,s._connection=Connection.instance(),s._titleBar=new egret.Shape,s._title=new egret.TextField,s._scrollView=new egret.ScrollView,s.onAddToStage=function(){var t=Math.round(.15*s._window.height);s._sHight=t>100?100:t,s._backGround=new egret.Shape,s._backGround.graphics.beginFill(331795),s._backGround.graphics.drawRect(0,0,s._width,s._height),s._backGround.graphics.endFill(),s.addChild(s._backGround),s._titleBar.graphics.lineStyle(1,16711422),s._titleBar.graphics.beginFill(1250067),s._titleBar.graphics.drawRect(0,0,s._width-1,s._width/4),s._titleBar.graphics.endFill(),s.addChild(s._titleBar),s._title.size=Math.round(.7*s._titleBar.height),s._title.text="Party",s._title.textColor=9934743,s._title.y=s._titleBar.y+s._titleBar.height/2-s._title.height/2,s._title.x=s._titleBar.width/2-s._title.width/2,s.addChild(s._title),s._line=new egret.Shape,s._line.graphics.lineStyle(1,7303023),s._line.graphics.moveTo(s._width,s._titleBar.height),s._line.graphics.lineTo(s._width,s._height),s.addChild(s._line),s._connection.socket.on("party",function(t){s.applyData(t)}),s._scrollView.width=s._backGround.width,s._scrollView.height=s._backGround.height-s._titleBar.height,s._scrollView.y=s._titleBar.height,s.addChild(s._scrollView),s._scrollContent=new egret.DisplayObjectContainer,s._scrollContent.width=s._scrollView.width,s._scrollView.setContent(s._scrollContent),s.applyData(s._data)},s._data=s._connection.initialData.character.party,s.addEventListener(egret.Event.ADDED_TO_STAGE,s.onAddToStage,s),s}return __extends(e,t),e.prototype.applyData=function(t){var e=this;this._scrollContent.removeChildren();var i;t.forEach(function(t){var a=new PartyMember(t);a.height=e._sHight,a.y=i?i.y+i.height:0,e._scrollContent.addChild(a),i=a})},e}(egret.DisplayObjectContainer);window.Party=i,__reflect(i.prototype,"Party",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._data=e,i._circle=new egret.Shape,i._connection=Connection.instance(),i._hpBar=new egret.Shape,i._spBar=new egret.Shape,i._mpBar=new egret.Shape,i._statusBars=new egret.DisplayObjectContainer,i._sb_background=new egret.Shape,i._effects=new egret.DisplayObjectContainer,i.onAddToStage=function(){i._rat1=i.createBitmapByName(i._data.image);var t=2*i.height/i._rat1.height;if(i._rat1.height=2*i.height,i._rat1.width=i._rat1.width*t,i._rat1.scaleX=.5,i._rat1.scaleY=.5,i._rat1.x=0-(i._rat1.width-i._rat1.height)/2,i.addChild(i._rat1),i._circle.graphics.clear(),i._circle.graphics.beginFill(65280),i._circle.graphics.drawCircle(0,0,i._rat1.height/4),i._circle.graphics.endFill(),i._circle.x=i._rat1.height/4,i._circle.y=i._rat1.height/4,i._rat1.mask=i._circle,i.addChild(i._circle),i._data.isLeader){i._groupLeader=i.createBitmapByName("group-leader_svg");var e=20/i._groupLeader.width;i._groupLeader.width=20,i._groupLeader.height=e*i._groupLeader.height,i._groupLeader.x=i._rat1.height/2-i._groupLeader.width-2,i._groupLeader.y=2,i.addChild(i._groupLeader)}if(i._data.isDefend){i._groupDefended=i.createBitmapByName("group-defend_svg");var a=20/i._groupDefended.width;i._groupDefended.width=20,i._groupDefended.height=a*i._groupDefended.height,i._groupDefended.x=i._rat1.height/2-i._groupDefended.width-2,i._groupLeader?i._groupDefended.y=i._groupLeader.y+i._groupLeader.height+4:i._groupDefended.y=2,i.addChild(i._groupDefended)}i.addChild(i._statusBars),i._sb_background.graphics.beginFill(988440),i._sb_background.graphics.drawRect(0,0,i._rat1.height/2,21),i._sb_background.graphics.endFill(),i._statusBars.addChild(i._sb_background),t=i._data.bars.hp/i._data.bars.maxHp,i._hpBar.graphics.beginFill(1===t?10880261:9175811),i._hpBar.graphics.drawRect(0,0,i._statusBars.width*t-1,5),i._hpBar.graphics.endFill(),i._hpBar.y=2,i._statusBars.addChild(i._hpBar),t=i._data.bars.sp/i._data.bars.maxSp,i._spBar.graphics.beginFill(15900733),i._spBar.graphics.drawRect(0,0,i._statusBars.width*t-1,5),i._spBar.graphics.endFill(),i._spBar.y=i._hpBar.y+i._hpBar.height+1,i._statusBars.addChild(i._spBar),t=i._data.bars.mp/i._data.bars.maxMp,i._mpBar.graphics.beginFill(1844134),i._mpBar.graphics.drawRect(0,0,i._statusBars.width*t-1,5),i._mpBar.graphics.endFill(),i._mpBar.y=i._spBar.y+i._spBar.height+1,i._statusBars.addChild(i._mpBar),i._statusBars.y=i._rat1.height/2-i._statusBars.height/2,i._name=new egret.TextField,i._name.size=12,i._name.stroke=1,i._name.strokeColor=0,i._name.textColor=9228011,i._name.text=i._data.name,i._name.x=2,i._name.y=i._statusBars.y-i._name.height,i.addChild(i._name),i.addChild(i._effects),i._effects.x=2,i._effects.y=2,0!=i._data.effects.length&&i.applyEffects(),i._connection.socket.on(i._data.id,function(t){t.content.hasOwnProperty("sp")?i.changeSp(t.content.sp,t.content.maxSp):t.content.hasOwnProperty("hp")?i.changeHp(t.content.hp,t.content.maxHp):t.content.hasOwnProperty("mp")?i.changeMp(t.content.mp,t.content.maxMp):"effects"===t.path[0]&&(i._data.effects=t.content,i.applyEffects())}),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onDefend,i)},i.applyEffects=function(){i._effects.removeChildren();var t;i._data.effects.forEach(function(e){var a=i.createBitmapByName(e);a.width=40,a.height=40,a.scaleY=.5,a.scaleX=.5,i._effects.addChild(a),a.y=t?t.y+20+2:0,t=a})},i.onDefend=function(){i._connection.socket.emit("defend-this",i._data.id)},i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i
}return __extends(e,t),e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.changeHp=function(t,e){this._hpBar.graphics.clear();var i=parseInt(t)/parseInt(e);this._hpBar.graphics.beginFill(1===i?10880261:9175811),this._hpBar.graphics.drawRect(0,0,this._statusBars.width*i,5),this._hpBar.graphics.endFill()},e.prototype.changeSp=function(t,e){this._spBar.graphics.clear();var i=parseInt(t)/parseInt(e);this._spBar.graphics.beginFill(15900733),this._spBar.graphics.drawRect(0,0,this._statusBars.width*i,5),this._spBar.graphics.endFill()},e.prototype.changeMp=function(t,e){this._mpBar.graphics.clear();var i=parseInt(t)/parseInt(e);this._mpBar.graphics.beginFill(1844134),this._mpBar.graphics.drawRect(0,0,this._statusBars.width*i,5),this._mpBar.graphics.endFill()},e}(egret.DisplayObjectContainer);window.PartyMember=i,__reflect(i.prototype,"PartyMember",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._cellSize=e,i._connection=Connection.instance(),i._skillBgs=[],i._skills=[],i._data=[],i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i._data=i._connection.initialData.character.spells,i}return __extends(e,t),e.prototype.onAddToStage=function(t){var e=this,i=new egret.Shape,a=new egret.Shape,s=new egret.Shape,n=new egret.Shape,r=new egret.Shape,h=new egret.Shape;this._skillBgs=[i,a,s,n,r,h],i.graphics.lineStyle(1,7303023),i.graphics.beginFill(198416),i.graphics.drawRect(0,0,this._cellSize,this._cellSize),i.graphics.endFill(),this.addChild(i),a.graphics.lineStyle(1,7303023),a.graphics.beginFill(198416),a.graphics.drawRect(0,0,this._cellSize,this._cellSize),a.x=i.width,a.graphics.endFill(),this.addChild(a),s.graphics.lineStyle(1,7303023),s.graphics.beginFill(198416),s.graphics.drawRect(0,0,this._cellSize,this._cellSize),s.x=a.x+a.width,s.graphics.endFill(),this.addChild(s),n.graphics.lineStyle(1,7303023),n.graphics.beginFill(198416),n.graphics.drawRect(0,0,this._cellSize,this._cellSize),n.x=s.x+s.width,n.graphics.endFill(),this.addChild(n),r.graphics.lineStyle(1,7303023),r.graphics.beginFill(198416),r.graphics.drawRect(0,0,this._cellSize,this._cellSize),r.x=n.x+n.width,r.graphics.endFill(),this.addChild(r),h.graphics.lineStyle(1,7303023),h.graphics.beginFill(198416),h.graphics.drawRect(0,0,this._cellSize,this._cellSize),h.x=r.x+r.width,h.graphics.endFill(),this.addChild(h),this.applyData(this._data),this._connection.socket.on("character",function(t){0===t.path.length?e.applyData(t.content.spells):"spells"===t.path[0]&&Array.isArray(t.content)?e.applyData(t.content):"image"===t.path[2]?e._skills[parseInt(t.path[1])].texture=RES.getRes(t.content):"type"===t.path[2]&&("u"===t.content?e._skills[parseInt(t.path[1])].alpha=.15:"c"===t.content?e._skills[parseInt(t.path[1])].alpha=.3:"a"===t.content&&(e._skills[parseInt(t.path[1])].alpha=1))})},e.prototype.applyData=function(t){var e=this;if(0!==t.length)for(var i=function(i){if(!t[i]&&a._skills[i]&&(a._skills[i].visible=!1,a._skillBgs[i].graphics.clear(),a._skillBgs[i].graphics.lineStyle(1,7303023),a._skillBgs[i].graphics.beginFill(198416),a._skillBgs[i].graphics.drawRect(0,0,a._cellSize,a._cellSize),a._skillBgs[i].graphics.endFill()),!t[i])return a._skills.length<=i&&a._skills.push(null),"continue";if(a._skills[i])return a._skills[i].texture=RES.getRes(t[i].image),a._skills[i].visible=!0,"p"===t[i].type&&(a._skillBgs[i].graphics.clear(),a._skillBgs[i].graphics.lineStyle(1,7303023),a._skillBgs[i].graphics.beginFill(13938487),a._skillBgs[i].graphics.drawRect(0,0,a._cellSize,a._cellSize),a._skillBgs[i].graphics.endFill()),"u"===t[i].type&&(a._skills[i].alpha=.15),"c"===t[i].type?a._skills[i].alpha=.3:a._skills[i].alpha=1,"continue";var s=a.createBitmapByName(t[i].image);s.x=a._skillBgs[i].x+3,s.y=a._skillBgs[i].y+3,s.width=2*(a._skillBgs[i].width-6),s.height=2*(a._skillBgs[i].height-6),s.scaleY=.5,s.scaleX=.5,a.addChild(s),s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e._connection.socket.emit("a",{a:"cast",p:i})},a),a._skills[i]=s,"u"===t[i].type?s.alpha=.15:"c"===t[i].type&&(s.alpha=.3),"p"===t[i].type&&(a._skillBgs[i].graphics.clear(),a._skillBgs[i].graphics.lineStyle(1,7303023),a._skillBgs[i].graphics.beginFill(13938487),a._skillBgs[i].graphics.drawRect(0,0,a._cellSize,a._cellSize),a._skillBgs[i].graphics.endFill())},a=this,s=0;s<t.length;s++)i(s)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);window.SkillBar=i,__reflect(i.prototype,"SkillBar",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i._bg=new egret.Shape,i._scrollBg=new egret.Shape,i._viewport=A1Viewport.instance(),i._connection=Connection.instance(),i._strTextLabel=new egret.TextField,i._dexTextLabel=new egret.TextField,i._intTextLabel=new egret.TextField,i._hpTextLabel=new egret.TextField,i._spTextLabel=new egret.TextField,i._mpTextLabel=new egret.TextField,i._strText=new egret.TextField,i._dexText=new egret.TextField,i._intText=new egret.TextField,i._hpText=new egret.TextField,i._spText=new egret.TextField,i._mpText=new egret.TextField,i._titleBar=new egret.Shape,i._title=new egret.TextField,i._baseDamageLabel=new egret.TextField,i._baseDamage=new egret.TextField,i._resistTitle=new egret.TextField,i._dmgTypesTitle=new egret.TextField,i._scrollView=new egret.ScrollView,i._scrollContent=new egret.DisplayObjectContainer,i._resists=new egret.DisplayObjectContainer,i._damage=new egret.DisplayObjectContainer,i.toggleVisible=function(){if(i.visible=!i.visible,!i.visible)return void(i._scrollView.scrollTop=0);var t=i._parent.getChildByName("gameLog"),e=i._parent.getChildByName("gameHeader");i._bg.graphics.clear(),i._bg.graphics.beginFill(331795,.93),i._bg.graphics.drawRect(0,0,i._viewport.windowProps().width,t.y-e.height),i._bg.graphics.endFill(),i._scrollView.height=i._bg.height-i._titleBar.height,i._scrollBg.graphics.clear(),i._scrollBg.graphics.beginFill(0,.25),i._scrollBg.graphics.drawRect(0,0,i._viewport.windowProps().width,i._scrollContent.height),i._scrollBg.graphics.endFill()},i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i._initialData=i._connection.initialData.character,i}return __extends(e,t),e.prototype.onAddToStage=function(){this.addChild(this._bg);var t=this._parent.getChildByName("gameHeader");this._titleBar.graphics.lineStyle(1,15724527),this._titleBar.graphics.beginFill(1250067),this._titleBar.graphics.drawRect(0,0,this._viewport.windowProps().width-1,t.height/4),this._titleBar.graphics.endFill(),this._titleBar.y=0,this.addChild(this._titleBar),this._title.size=Math.round(.7*this._titleBar.height),this._title.text="Stats",this._title.textColor=9934743,this._title.y=this._titleBar.y+this._titleBar.height/2-this._title.height/2,this._title.x=this._titleBar.width/2-this._title.width/2,this.addChild(this._title),this._scrollView.y=this._titleBar.y+this._titleBar.height,this._scrollView.width=this._viewport.windowProps().width,this.addChild(this._scrollView),this._scrollContent.width=this._viewport.windowProps().width,this._scrollView.setContent(this._scrollContent),this.applyData(),this.registerListeners()},e.prototype.applyData=function(){this._addedLast=null,this._resists.removeChildren(),this._damage.removeChildren(),this._scrollContent.removeChildren();var t=this._parent.getChildByName("gameHeader");this._scrollContent.addChild(this._scrollBg),this._strTextLabel.text="Strength:",this._strTextLabel.size=16,this._strTextLabel.x=t.height/12,this._strTextLabel.y=t.height/12-1,this._strTextLabel.textColor=9934743,this._scrollContent.addChild(this._strTextLabel),this._dexTextLabel.text="Dexterity:",this._dexTextLabel.size=16,this._dexTextLabel.x=t.height/12,this._dexTextLabel.y=this._strTextLabel.y+this._strTextLabel.height+t.height/12-1,this._dexTextLabel.textColor=9934743,this._scrollContent.addChild(this._dexTextLabel),this._intTextLabel.text="Intelligence:",this._intTextLabel.size=16,this._intTextLabel.x=t.height/12,this._intTextLabel.y=this._dexTextLabel.y+this._dexTextLabel.height+t.height/12-1,this._intTextLabel.textColor=9934743,this._scrollContent.addChild(this._intTextLabel),this._strText.text=this._initialData.stats.str,this._strText.size=16,this._strText.x=this._intTextLabel.x+this._intTextLabel.width+t.height/3.3,this._strText.y=this._strTextLabel.y,this._strText.textColor=16777215,this._scrollContent.addChild(this._strText),this._dexText.text=this._initialData.stats.dex,this._dexText.size=16,this._dexText.x=this._strText.x,this._dexText.y=this._dexTextLabel.y,this._dexText.textColor=16777215,this._scrollContent.addChild(this._dexText),this._intText.text=this._initialData.stats["int"],this._intText.size=16,this._intText.x=this._strText.x,this._intText.y=this._intTextLabel.y,this._intText.textColor=16777215,this._scrollContent.addChild(this._intText),this._hpTextLabel.text="Health:",this._hpTextLabel.size=16,this._hpTextLabel.x=this.getSLabelsX(t),this._hpTextLabel.y=this._strTextLabel.y,this._hpTextLabel.textColor=9934743,this._scrollContent.addChild(this._hpTextLabel),this._spTextLabel.text="Stamina:",this._spTextLabel.size=16,this._spTextLabel.x=this._hpTextLabel.x,this._spTextLabel.y=this._dexTextLabel.y,this._spTextLabel.textColor=9934743,this._scrollContent.addChild(this._spTextLabel),this._mpTextLabel.text="Mana:",this._mpTextLabel.size=16,this._mpTextLabel.x=this._hpTextLabel.x,this._mpTextLabel.y=this._intTextLabel.y,this._mpTextLabel.textColor=9934743,this._scrollContent.addChild(this._mpTextLabel),this._hpText.text=this._initialData.bars.hp+" / "+this._initialData.bars.maxHp,this._hpText.size=16,this._hpText.x=this._spTextLabel.x+this._spTextLabel.width+t.height/3.3,this._hpText.y=this._strTextLabel.y,this._hpText.textColor=16777215,this._scrollContent.addChild(this._hpText),this._spText.text=this._initialData.bars.sp+" / "+this._initialData.bars.maxSp,this._spText.size=16,this._spText.x=this._hpText.x,this._spText.y=this._dexTextLabel.y,this._spText.textColor=16777215,this._scrollContent.addChild(this._spText),this._mpText.text=this._initialData.bars.mp+" / "+this._initialData.bars.maxMp,this._mpText.size=16,this._mpText.x=this._hpText.x,this._mpText.y=this._intTextLabel.y,this._mpText.textColor=16777215,this._scrollContent.addChild(this._mpText),this._scrollContent.addChild(this._damage),this._scrollContent.addChild(this._resists);var e=!1;for(var i in this._initialData.skills)if(this._initialData.skills.hasOwnProperty(i)){var a=new egret.TextField;a.text=i.charAt(0).toUpperCase()+i.slice(1)+":",a.size=16,a.x=e?this._hpTextLabel.x:this._strTextLabel.x,this._addedLast?a.y=e?this._addedLast.y:this._addedLast.y+this._addedLast.height+t.height/12-1:a.y=this._intTextLabel.y+this._intTextLabel.height+t.height/4,a.textColor=9934743,this._scrollContent.addChild(a);var s=new egret.TextField;s.text=this._initialData.skills[i]/10+"%",s.size=16,s.x=e?this._hpText.x:this._strText.x,s.name=i,s.y=a.y,s.textColor=16777215,this._scrollContent.addChild(s),this._addedLast=a,e=!e}this._addedLast||(this._addedLast=this._mpText);var n=this.toAverageDmg();this._baseDamageLabel.text=this._initialData.damage.weapon,this._baseDamageLabel.size=16,this._baseDamageLabel.x=this._strTextLabel.x,this._baseDamageLabel.y=this._addedLast.y+this._addedLast.height+t.height/4,this._baseDamageLabel.textColor=16777215,this._scrollContent.addChild(this._baseDamageLabel),this._addedLast=this._baseDamageLabel,this._baseDamage.text=n.dmgMin.toFixed()+" - "+n.dmgMax.toFixed()+"   "+this._initialData.damage.type,this._baseDamage.size=16,this._baseDamage.x=this._baseDamageLabel.x+this._baseDamageLabel.width+t.height/8,this._baseDamage.y=this._baseDamageLabel.y,this._baseDamage.textColor=16777215,this._scrollContent.addChild(this._baseDamage),this._resists.y=this._addedLast.y+this._addedLast.height+t.height/4,this._resists.x=this._hpTextLabel.x,this._damage.y=this._resists.y,this._damage.x=this._strTextLabel.x,this._resistTitle.text="Resists",this._resistTitle.size=16,this._resistTitle.textColor=16777215,this._resists.addChild(this._resistTitle),this._addedLast=this._resistTitle,this.addResist("physical",this._initialData.resists.physical.value),this.addResist("strike",this._initialData.resists.physical.strike,!0),this.addResist("slash",this._initialData.resists.physical.slash,!0),this.addResist("thrust",this._initialData.resists.physical.thrust,!0),this.addResist("magic",this._initialData.resists.magic),this.addResist("cold",this._initialData.resists.cold),this.addResist("fire",this._initialData.resists.fire),this.addResist("lightning",this._initialData.resists.lightning),this.addResist("dark",this._initialData.resists.dark),this.addResist("stagger",this._initialData.resists.stagger),this.addResist("bleed",this._initialData.resists.bleed),this.addResist("frostbite",this._initialData.resists.frostbite),this.addResist("poison",this._initialData.resists.poison),this.addResist("toxic",this._initialData.resists.toxic),this._addedLast=this._resists,this._dmgTypesTitle.text="Damage",this._dmgTypesTitle.size=16,this._dmgTypesTitle.textColor=16777215,this._damage.addChild(this._dmgTypesTitle),this._addedLast=this._dmgTypesTitle,this.addDamage("magic",n.magic.toFixed()),this.addDamage("cold",n.cold.toFixed()),this.addDamage("fire",n.fire.toFixed()),this.addDamage("lightning",n.lightning.toFixed()),this.addDamage("dark",n.dark.toFixed()),this.addDamage("critical",n.critical.toFixed()),this.addDamage("stagger",n.stagger.toFixed()),this.addDamage("bleed",n.bleed.toFixed()),this.addDamage("frostbite",n.frostbite.toFixed()),this.addDamage("poison",n.poison.toFixed()),this.addDamage("toxic",n.toxic.toFixed()),this._scrollContent.height=this._resists.y+this._resists.height+t.height/12-1},e.prototype.addResist=function(t,e,i){void 0===i&&(i=!1);var a=new egret.TextField;a.text=t.charAt(0).toUpperCase()+t.slice(1)+"Res:",a.size=16,a.x=i?16:0,a.y=this._addedLast.y+this._addedLast.height+8,a.textColor=9934743,this._resists.addChild(a);var s=new egret.TextField;s.text=e+"%",s.size=16,s.x=this._strText.x,s.name=t+"Res",s.y=a.y,s.textColor=16777215,this._resists.addChild(s),this._addedLast=a},e.prototype.toAverageDmg=function(){var t={},e=1;for(var i in this._initialData.damage.hit)this._initialData.damage.hit.hasOwnProperty(i)&&(e-=this._initialData.damage.hit[i]/100);for(var i in this._initialData.damage.regular)this._initialData.damage.regular.hasOwnProperty(i)&&(t[i]=e*this._initialData.damage.regular[i]);for(var i in this._initialData.damage.hit)if(this._initialData.damage.hit.hasOwnProperty(i))for(var a in this._initialData.damage[i])this._initialData.damage[i].hasOwnProperty(a)&&(t[a]+=this._initialData.damage[i][a]*(this._initialData.damage.hit[i]/100));return t},e.prototype.addDamage=function(t,e,i){void 0===i&&(i=!1);var a=new egret.TextField;a.text=t.charAt(0).toUpperCase()+t.slice(1)+":",a.size=16,a.x=i?16:0,a.y=this._addedLast.y+this._addedLast.height+8,a.textColor=9934743,this._damage.addChild(a);var s=new egret.TextField;s.text=""+e,s.size=16,s.x=this._strText.x,s.name=t,s.y=a.y,s.textColor=16777215,this._damage.addChild(s),this._addedLast=a},e.prototype.registerListeners=function(){var t=this;this._connection.socket.on("character",function(e){0===e.path.length?t._initialData=e.content:1===e.path.length&&"effects"!==e.path[0]?t._initialData[e.path[0]]=e.content:2===e.path.length&&(t._initialData[e.path[0]][e.path[1]]=e.content),t.applyData()})},e.prototype.getSLabelsX=function(t){var e=this._strText.x+this._strText.width+t.height/1.5,i=this._dexText.x+this._dexText.width+t.height/1.5,a=this._intText.x+this._intText.width+t.height/1.5;return e>i?e>a?e:a:i>a?i:a},e}(egret.DisplayObjectContainer);window.StatsScreen=i,__reflect(i.prototype,"StatsScreen",[])},function(t,e){var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(egret.DisplayObjectContainer);window.StatusBar=i,__reflect(i.prototype,"StatusBar",[])},function(t,e){var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.update=function(){return void{}},e._viewport=A1Viewport.instance(),e}return __extends(e,t),e.prototype.onViewCreated=function(){},e.prototype.onViewStopped=function(){},e.prototype.onRunState=function(){},e.prototype.stop=function(){this._viewport.offResize(this.update),this.onViewStopped()},e.prototype.createView=function(){this._viewport.onResize(this.update),this.onViewCreated()},e.prototype.loadAssets=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.createView(),this.update(),[2]})})},e}(egret.DisplayObjectContainer);window.A1Scene=i,__reflect(i.prototype,"A1Scene",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i.update=function(){i._text.x=(i._parent.width-i.width)/2,i._text.y=(i._parent.height-i.height)/2},i}return __extends(e,t),e.prototype.onViewCreated=function(){console.log("LOADING_SCENE"),this._text=new egret.TextField,this._text.size=32,this._text.text="Loading... 0/0",this.addChild(this._text),this.update()},e.prototype.onProgress=function(t,e){console.log("LOADING_SCENE: Loading... "+t+"/"+e),this._text.text="Loading... "+t+"/"+e,this.update()},e}(A1Scene);window.A1LoadingScene=i,__reflect(i.prototype,"A1LoadingScene",["RES.PromiseTaskReporter"])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i.update=function(){i._text.x=(i._parent.width-i.width)/2,i._text.y=(i._parent.height-i.height)/2},i.createView(),i.update(),i}return __extends(e,t),e.prototype.onViewCreated=function(){console.log("SPLASH_SCREEN"),this._text=new egret.TextField,this._text.size=32,this._text.text="A1 Core Game",this.addChild(this._text)},e}(A1Scene);window.A1SplashScene=i,__reflect(i.prototype,"A1SplashScene",[])},function(t,e){var i=function(){function t(t){this._container=t,this._scenes=new Map,this._constructors=new Map,this._constructors.set("SPLASH_SCREEN",A1SplashScene),this._constructors.set("LOADING_SCENE",A1LoadingScene)}return t.instance=function(e){return null==t._instance&&null!=e&&(t._instance=new t(e)),t._instance},t.prototype.register=function(t,e){this._constructors.set(t,e)},t.prototype.setState=function(t){return void 0===t&&(t="SPLASH_SCREEN"),__awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return console.log("setState",t),this._state===t?[2,this._currentStateScene]:(this.stopCurrentState(),this._state=t,e=this,[4,this.runState(t)]);case 1:return e._currentStateScene=i.sent(),[2,this._currentStateScene]}})})},t.prototype.update=function(){this._currentStateScene.update()},t.prototype.runState=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return console.log("runState",t),e=this._scenes.get(t),e?(this._container.addChildAt(e,0),e.onRunState(),[2,this._scenes.get(t)]):[4,this.createNewScene(t)];case 1:return e=i.sent(),this._container.addChildAt(e,0),[2,e]}})})},t.prototype.createNewScene=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return console.log("createNewScene",t),e=this.constructScene(t),"SPLASH_SCREEN"===t?[3,2]:[4,this.loadSceneAssets(e)];case 1:i.sent(),i.label=2;case 2:return[2,e]}})})},t.prototype.loadSceneAssets=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(a){switch(a.label){case 0:return console.log("loadSceneAssets "+this._state),this._scenes.has("LOADING_SCENE")?(i=this._scenes.get("LOADING_SCENE"),[3,3]):[3,1];case 1:return[4,this.createLoadingScene()];case 2:i=a.sent(),a.label=3;case 3:return e=i,this._container.addChild(e),[4,t.loadAssets(e)];case 4:return a.sent(),e.stop(),this._container.removeChild(e),[2]}})})},t.prototype.wait3400=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t,e){setTimeout(function(){t()},0)})]})})},t.prototype.createLoadingScene=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return console.log("createLoadingScene"),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),t=this.constructScene("SPLASH_SCREEN"),this._container.addChild(t),[4,this.wait3400()];case 2:return i.sent(),e=this.constructScene("LOADING_SCENE"),[4,e.loadAssets(void 0)];case 3:return i.sent(),t.stop(),this._container.removeChild(t),[2,e]}})})},t.prototype.constructScene=function(t){console.log("constructScene "+t);var e=this._constructors.get(t),i=new e(this._container);return this._scenes.set(t,i),i},t.prototype.stopCurrentState=function(){console.log("stopCurrentState",this._state),null!=this._currentStateScene&&(this._currentStateScene.stop(),this._container.removeChild(this._currentStateScene))},t}();window.A1State=i,__reflect(i.prototype,"A1State",[])},function(t,e){},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.updateDimentions=function(t){t.ratio<APP_ASPECT_RATIO?this.setThinScreen(t):this.setWideScreen(t),this.updateRectangle()},e.prototype.createView=function(){this._rect=new egret.Shape,this.addChild(this._rect)},e.prototype.updateRectangle=function(){this._rect.graphics.clear(),this._rect.graphics.lineStyle(1,16711680),this._rect.graphics.drawRect(0,0,this.width-2,this.height-2)},e.prototype.setThinScreen=function(t){this.width=t.width,this.height=this.width/APP_ASPECT_RATIO,this.x=0,this.y=(t.height-this.height)/2},e.prototype.setWideScreen=function(t){this.width=t.height*APP_ASPECT_RATIO,this.height=t.height,this.x=(t.width-this.width)/2,this.y=0},e}(egret.DisplayObjectContainer);window.A1AspectScreen=i,__reflect(i.prototype,"A1AspectScreen",["IA1Screen"])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.updateDimentions=function(t){this.width=t.width,this.height=t.height,this.updateRectangle()},e.prototype.createView=function(){this._rect=new egret.Shape,this.addChild(this._rect)},e.prototype.updateRectangle=function(){this._rect.graphics.clear(),this._rect.graphics.lineStyle(0,65280),this._rect.graphics.drawRect(0,0,this.width-2,this.height-2)},e}(egret.DisplayObjectContainer);window.A1FullScreen=i,__reflect(i.prototype,"A1FullScreen",["IA1Screen"])},function(t,e){var i=640;window.APP_CONTENT_WIDTH=i;var a=1136;window.APP_CONTENT_HEIGHT=a;var s=i/a;window.APP_ASPECT_RATIO=s;var n=function(){function t(t){this._stage=t,this._layers=new Map,this._resizeSubscribers=new Set,this._canvas=document.querySelector(".egret-player canvas"),this._stage.addEventListener(egret.Event.RESIZE,this.onStageResize,this),this.onStageResize(),this._viewport=new egret.DisplayObjectContainer,this._stage.addChild(this._viewport)}return t.instance=function(e){return null==t._instance&&null!=e&&(t._instance=new t(e)),t._instance},t.prototype.register=function(t,e){if(this._layers.has(t))return this._layers.get(t);if(null==e)return null;var i=this.createScreenByType(e);return null==i?null:(this._layers.set(t,i),this._viewport.addChild(i),i.updateDimentions(this.windowProps()),i)},t.prototype.toAspectSize=function(t){return t*this._aspectScale},t.prototype.onResize=function(t){this._resizeSubscribers.add(t)},t.prototype.offResize=function(t){this._resizeSubscribers["delete"](t)},t.prototype.notifyResize=function(){this._resizeSubscribers.forEach(function(t){t()})},t.prototype.applyAspectRatio=function(t){this._layers.forEach(function(e){e.updateDimentions(t)})},t.prototype.createScreenByType=function(t){switch(t){case"FullScreen":return new A1FullScreen;case"AspectScreen":return new A1AspectScreen;default:return null}},t.prototype.onStageResize=function(){var t=this.windowProps();this.updateAspectScale(t),this.applyAspectRatio(t),this.notifyResize()},t.prototype.updateAspectScale=function(t){if(t.ratio<s)return void(this._aspectScale=t.width/i);var e=t.height*s;this._aspectScale=e/i},t.prototype.windowProps=function(){return{width:this._canvas.width/window.devicePixelRatio,height:this._canvas.height/window.devicePixelRatio,ratio:this._canvas.width/this._canvas.height}},t}();window.A1Viewport=n,__reflect(n.prototype,"A1Viewport",[])},function(t,e){},function(t,e){},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i._connection=Connection.instance(),i._backGroundInitialSize={width:0,height:0},i._scrollBg=new egret.Shape,i._titleBar=new egret.Shape,i._title=new egret.TextField,i._landsScrollView=new egret.ScrollView,i._leaveLandBtnBg=new egret.Shape,i._isCreated=!1,i._creatures=new egret.DisplayObjectContainer,i._lands=new egret.DisplayObjectContainer,i.updateLandTitle=function(){i._title.text=i._worldInitialData.location.name,i._title.x=i._titleBar.x+i._titleBar.width/2-i._title.width/2},i.updateBlockPositions=function(){i._landsScrollView.scrollTop=0,i._creatures.y=i._worldInitialData.creatures.length>0?24:0,i._lands.y=i._creatures.y+i._creatures.height+15,i._landsScrollContent.height=i._creatures.y+i._creatures.height+i._lands.height+15+15,i._scrollBg.graphics.clear(),i._scrollBg.graphics.beginFill(0,.01),i._scrollBg.graphics.drawRect(0,0,i._viewport.windowProps().width,i._landsScrollContent.height),i._scrollBg.graphics.endFill()},i.removeExisting=function(t){var e=i._creatures.getChildByName(t);if(e){i._creatures.removeChild(e);var a;return i._worldInitialData.creatures.forEach(function(t){var e=i._creatures.getChildByName(t.id);a?e.y=a.y+70:e.y=0,a=e}),a?void(i._creatures.height=(a.height+10)*i._creatures.$children.length):void(i._creatures.height=0)}},i.addToExistingCreatures=function(){var t;i._landImage&&i._creatures.getChildByName("landImage")&&i._creatures.removeChild(i._landImage),i._worldInitialData.creatures.forEach(function(e){var a=i._creatures.getChildByName(e.id);a||(a=new Creature(e.name,e.id,e.image,e.hp,e.effects,e.mode),a.width=i._viewport.windowProps().width-i._titleBar.x-40,a.height=60,a.name=e.id,a.x=i._titleBar.x+25,i._creatures.addChild(a)),t?a.y=t.y+70:a.y=0,t=a,i._creatures.height=(t.height+10)*(i._creatures.$children.length-0)})},i.renderCreatures=function(){var t;if(0===i._worldInitialData.creatures.length&&i._worldInitialData.location.image){i._landImage=i.createBitmapByName(i._worldInitialData.location.image);var e=i._viewport.windowProps().width,a=1.5*(e-i._titleBar.x)/i._landImage.width;i._landImage.width=1.5*(e-i._titleBar.x),i._landImage.x=.5*-(e-i._titleBar.x)+i._titleBar.x,i._landImage.y=0,i._landImage.height=i._landImage.height*a,i._landImage.name="landImage",i._creatures.addChild(i._landImage),t=i._landImage,i._creatures.height=t.height}else i._worldInitialData.creatures.forEach(function(e){var a=new Creature(e.name,e.id,e.image,e.hp,e.effects,e.mode);a.width=i._viewport.windowProps().width-i._titleBar.x-40,a.height=60,a.x=i._titleBar.x+25,a.name=e.id,t?a.y=t.y+70:a.y=0,t=a,i._creatures.addChild(a)}),t?i._creatures.height=70*i._creatures.$children.length:i._creatures.height=0},i.renderLands=function(){var t=null;i._worldInitialData.lands.length>0&&(i._worldInitialData.lands.push({name:"Prototype World",image:"portal_png",id:i._worldInitialData.location.id,action:"random"}),i._worldInitialData.lands.forEach(function(e){var a=new Land(e.name,e.image,e.id,e.action);a.width=i._viewport.windowProps().width-i._titleBar.x-30,a.height=50,a.x=i._titleBar.x+15,t?a.y=t.y+t.height+10:a.y=0,t=a,i._lands.addChild(a)}),i._lands.height=60*i._lands.$children.length-10),0===i._worldInitialData.lands.length&&(i._leaveLandBtn=new egret.DisplayObjectContainer,i._leaveLandBtn.width=i._viewport.windowProps().width-i._titleBar.x-30,i._leaveLandBtn.height=50,i._leaveLandBtn.y=0,i._leaveLandBtn.x=i._titleBar.x+15,i._leaveLandBtnBg.graphics.beginFill(1644825),i._leaveLandBtnBg.graphics.drawRect(0,0,i._leaveLandBtn.width,i._leaveLandBtn.height),i._leaveLandBtnBg.graphics.endFill(),i._leaveLandBtn.addChild(i._leaveLandBtnBg),i._leaveLandBtnLabel=new egret.TextField,i._leaveLandBtnLabel.size=28,i._leaveLandBtnLabel.text="Leave Land",i._leaveLandBtnLabel.textColor=9934743,i._leaveLandBtnLabel.y=i._leaveLandBtnBg.y+i._leaveLandBtnBg.height/2-i._leaveLandBtnLabel.height/2,i._leaveLandBtnLabel.x=i._leaveLandBtnBg.width/2-i._leaveLandBtnLabel.width/2,i._leaveLandBtn.addChild(i._leaveLandBtnLabel),i._lands.addChild(i._leaveLandBtn),i._leaveLandBtn.touchEnabled=!0,i._leaveLandBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,i.leaveLand,i),t=i._leaveLandBtn,i._lands.height=50)},i.update=function(){i.resizeBackground()},i._worldInitialData=i._connection.initialData,i}return __extends(e,t),e.prototype.onViewCreated=function(){var t=this;if(!this._isCreated&&this._worldInitialData){console.log("WORLD_SCENE"),this._backGround=this.createBitmapByName("game_sceme_bg_png"),this._backGroundInitialSize.width=this._backGround.width,this._backGroundInitialSize.height=this._backGround.height,this.resizeBackground(),this.addChild(this._backGround);var e=Math.round(.15*this._viewport.windowProps().height),i=e>100?100:e,a=this._viewport.windowProps().width;this._titleBar.graphics.lineStyle(1,15724527),this._titleBar.graphics.beginFill(1250067,.01),this._titleBar.graphics.drawRect(0,0,a,i/4),this._titleBar.graphics.endFill(),this._titleBar.y=i,this._titleBar.x=0,this.addChild(this._titleBar),this._title.size=Math.round(.7*this._titleBar.height),this._title.text=this._worldInitialData.location.name,this._title.textColor=9934743,this._title.y=this._titleBar.y+this._titleBar.height/2-this._title.height/2,this.addChild(this._title),this._landsScrollView.width=this._viewport.windowProps().width,this._landsScrollView.height=this._parent.getChildByName("gameLog").y-i-i/4-2,this._landsScrollView.y=i+i/4+1,this.addChild(this._landsScrollView),this._landsScrollContent=new egret.DisplayObjectContainer,this._landsScrollContent.width=this._viewport.windowProps().width,this._landsScrollView.setContent(this._landsScrollContent),this._landsScrollContent.addChild(this._scrollBg),this._landsScrollContent.addChild(this._creatures),this._landsScrollContent.addChild(this._lands),this.onRunState(),this._isCreated=!0,this._connection.socket.on("location",function(e){t._worldInitialData.location=e.content,t.updateLandTitle()}),this._connection.socket.on("creatures",function(e){if(!Array.isArray(e.content)){if(e.content.id){var i=1===e.path.length?e.path[0]:"unshift";return t._worldInitialData.creatures[i](e.content),t.addToExistingCreatures(),void t.updateBlockPositions()}return t._worldInitialData.creatures=t._worldInitialData.creatures.filter(function(t){return t.id!==e.content}),t.removeExisting(e.content),void t.updateBlockPositions()}t._creatures.removeChildren(),t._creatures.height=0,t._worldInitialData.creatures=e.content,t.renderCreatures(),t.updateBlockPositions()}),this._connection.socket.on("lands",function(e){t._lands.removeChildren(),t._lands.height=0,t._worldInitialData.lands=e.content,t.renderLands(),t.updateBlockPositions()})}},e.prototype.onRunState=function(){this._worldInitialData=this._connection.initialData,this.applyData()},e.prototype.onViewStopped=function(){this._creatures.removeChildren(),this._lands.removeChildren()},e.prototype.applyData=function(){var t=this;this.updateLandTitle(),this.renderCreatures(),this.renderLands(),setTimeout(function(){t.updateBlockPositions()})},e.prototype.resizeBackground=function(){var t=this._viewport.toAspectSize(this._backGroundInitialSize.width);this._viewport.toAspectSize(this._backGroundInitialSize.height);if(this._parent.width>t){this._backGround.width=this._parent.width,this._backGround.height=this._backGroundInitialSize.height*(this._parent.width/this._backGroundInitialSize.width);var e=this._backGround.height-this._parent.height;this._backGround.x=0,this._backGround.y=-(e/2)
}else{this._backGround.height=this._parent.height,this._backGround.width=this._backGroundInitialSize.width*(this._parent.height/this._backGroundInitialSize.height);var i=this._backGround.width-this._parent.width;this._backGround.y=0,this._backGround.x=-(i/2)}},e.prototype.leaveLand=function(){this._connection.socket.emit("a",{a:"leave",p:this._worldInitialData.location.id})},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(A1Scene);window.GameScene=i,__reflect(i.prototype,"GameScene",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i._state=A1State.instance(),i._connection=Connection.instance(),i._isLogin=!0,i._backGroundInitialSize={width:0,height:0},i._prod="https://prototype-ws.herokuapp.com",i._dev="http://localhost:9000",i._origin=i._prod,i.update=function(){i.resizeBackground()},i._textures=[],i}return __extends(e,t),e.prototype.loadAssets=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,RES.loadGroup("home",0,t)];case 1:return i.sent(),console.log("loadSceneAssets DONE"),this.createView(),[3,3];case 2:return e=i.sent(),console.error(e),[3,3];case 3:return[2]}})})},e.prototype.onViewCreated=function(){console.log("HOME_SCENE"),this._backGround=this.createBitmapByName("barricade_jpg"),this._backGroundInitialSize.width=this._backGround.width,this._backGroundInitialSize.height=this._backGround.height,this.resizeBackground(),this.addChild(this._backGround);var t=.8*this._viewport.windowProps().width,e=16,i=13;this._loginBg=new egret.Shape,this._loginBg.y=this._viewport.windowProps().height/2-.7*t,this._loginBg.x=this._viewport.windowProps().width/2-t/2,this.addChild(this._loginBg),this._loginLabel=new egret.TextField,this._loginLabel.textColor=9605778,this._loginLabel.size=16,this._loginLabel.text="Character Name",this._loginLabel.y=this._loginBg.y+i,this._loginLabel.x=this._loginBg.x+i,this.addChild(this._loginLabel),this._loginInputBg=new egret.Shape,this._loginInputBg.graphics.lineStyle(1,7697781,.95),this._loginInputBg.graphics.beginFill(2302755,.95),this._loginInputBg.y=this._loginLabel.y+this._loginLabel.height+i/3,this._loginInputBg.x=this._loginBg.x+i,this.roundRect(this._loginInputBg,t-2*i,30,e-i),this._loginInputBg.graphics.endFill(),this.addChild(this._loginInputBg),this._loginInput=new egret.TextField,this._loginInput.textColor=10724259,this._loginInput.width=t-3*i,this._loginInput.restrict="A-Z 0-9_a-z",this._loginInput.type=egret.TextFieldType.INPUT,this._loginInput.size=16,this._loginInput.maxChars=20,this._loginInput.text="",this._loginInput.verticalAlign="middle",this._loginInput.y=this._loginInputBg.y,this._loginInput.x=this._loginBg.x+1.5*i,this.addChild(this._loginInput),this._passwordLabel=new egret.TextField,this._passwordLabel.textColor=9605778,this._passwordLabel.size=16,this._passwordLabel.text="Password",this._passwordLabel.y=this._loginInputBg.y+this._loginInputBg.height+i,this._passwordLabel.x=this._loginBg.x+i,this.addChild(this._passwordLabel),this._passwordInputBg=new egret.Shape,this._passwordInputBg.graphics.lineStyle(1,7697781,.95),this._passwordInputBg.graphics.beginFill(2302755,.95),this._passwordInputBg.y=this._passwordLabel.y+this._passwordLabel.height+i/3,this._passwordInputBg.x=this._loginBg.x+i,this.roundRect(this._passwordInputBg,t-2*i,30,e-i),this._passwordInputBg.graphics.endFill(),this.addChild(this._passwordInputBg),this._passwordInput=new egret.TextField,this._passwordInput.displayAsPassword=!0,this._passwordInput.textColor=10724259,this._passwordInput.width=t-3*i,this._passwordInput.type=egret.TextFieldType.INPUT,this._passwordInput.size=16,this._passwordInput.verticalAlign="middle",this._passwordInput.y=this._passwordInputBg.y,this._passwordInput.x=this._loginBg.x+1.5*i,this.addChild(this._passwordInput);var a=this._passwordInputBg.y+this._passwordInputBg.height+i-this._loginBg.y;this._loginBg.graphics.beginFill(2302755,.95),this.roundRect(this._loginBg,t,a,e),this._loginBg.graphics.endFill(),this._goBtnBg=new egret.Shape,this.addChild(this._goBtnBg),this._goBtnLabel=new egret.TextField,this._goBtnLabel.textColor=16711422,this._goBtnLabel.size=16,this._goBtnLabel.text="START",this._goBtnBg.graphics.lineStyle(1,16711422,.95),this._goBtnBg.graphics.beginFill(2302755,.95),this.roundRect(this._goBtnBg,this._goBtnLabel.width+6*i,45,e-i),this._goBtnBg.graphics.endFill(),this._goBtnBg.y=this._loginBg.y+this._loginBg.height+3*i,this._goBtnBg.x=this._viewport.windowProps().width/2-this._goBtnBg.width/2,this._goBtnLabel.y=this._goBtnBg.y+this._goBtnBg.height/2-this._goBtnLabel.height/2,this._goBtnLabel.x=this._goBtnBg.x+this._goBtnBg.width/2-this._goBtnLabel.width/2,this.addChild(this._goBtnLabel),this._goBtnBg.touchEnabled=!0,this._goBtnBg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLogin,this),this._goBtnLabel.touchEnabled=!0,this._goBtnLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLogin,this),this._switchModeBtnLabel=new egret.TextField,this._switchModeBtnLabel.textColor=16711422,this._switchModeBtnLabel.size=18,this._switchModeBtnLabel.text="Register new Character",this._switchModeBtnBg=new egret.Shape,this._switchModeBtnBg.graphics.lineStyle(1,16711422,.95),this._switchModeBtnBg.graphics.beginFill(2302755,.95),this.roundRect(this._switchModeBtnBg,this._switchModeBtnLabel.width+4*i,45,e-i),this._switchModeBtnBg.y=this._viewport.windowProps().height-90,this._switchModeBtnBg.x=this._viewport.windowProps().width/2-this._switchModeBtnBg.width/2,this._switchModeBtnBg.graphics.endFill(),this._switchModeBtnLabel.y=this._switchModeBtnBg.y+this._switchModeBtnBg.height/2-this._switchModeBtnLabel.height/2,this._switchModeBtnLabel.x=this._switchModeBtnBg.x+this._switchModeBtnBg.width/2-this._switchModeBtnLabel.width/2,this.addChild(this._switchModeBtnBg),this.addChild(this._switchModeBtnLabel),this._switchModeBtnBg.touchEnabled=!0,this._switchModeBtnBg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMode,this),this._switchModeBtnBg.touchEnabled=!0,this._switchModeBtnLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMode,this),this._passwordCLabel=new egret.TextField,this._passwordCLabel.textColor=9605778,this._passwordCLabel.size=16,this._passwordCLabel.text="Confirm Password",this._passwordCLabel.y=this._passwordInput.y+this._passwordInput.height+i,this._passwordCLabel.x=this._loginBg.x+i,this.addChild(this._passwordCLabel),this._passwordCInputBg=new egret.Shape,this._passwordCInputBg.graphics.lineStyle(1,7697781,.95),this._passwordCInputBg.graphics.beginFill(2302755,.95),this._passwordCInputBg.y=this._passwordCLabel.y+this._passwordCLabel.height+i/3,this._passwordCInputBg.x=this._loginBg.x+i,this.roundRect(this._passwordCInputBg,t-2*i,30,e-i),this._passwordCInputBg.graphics.endFill(),this.addChild(this._passwordCInputBg),this._passwordCInput=new egret.TextField,this._passwordCInput.displayAsPassword=!0,this._passwordCInput.textColor=10724259,this._passwordCInput.width=t-3*i,this._passwordCInput.type=egret.TextFieldType.INPUT,this._passwordCInput.size=16,this._passwordCInput.verticalAlign="middle",this._passwordCInput.y=this._passwordCInputBg.y,this._passwordCInput.x=this._loginBg.x+1.5*i,this.addChild(this._passwordCInput),this._passwordCLabel.visible=!1,this._passwordCInputBg.visible=!1,this._passwordCInput.visible=!1},e.prototype.onMode=function(){var t=.8*this._viewport.windowProps().width,e=16,i=13;this._isLogin=!this._isLogin,this._switchModeBtnLabel.text=this._isLogin?"Register new Character":"Existing Character",this._switchModeBtnLabel.x=this._switchModeBtnBg.x+this._switchModeBtnBg.width/2-this._switchModeBtnLabel.width/2,this._goBtnLabel.text=this._isLogin?"START":"REGISTER",this._goBtnLabel.x=this._goBtnBg.x+this._goBtnBg.width/2-this._goBtnLabel.width/2,this._passwordCLabel.visible=!this._isLogin,this._passwordCInputBg.visible=!this._isLogin,this._passwordCInput.visible=!this._isLogin;var a;a=this._isLogin?this._passwordInputBg.y+this._passwordInputBg.height+i-this._loginBg.y:this._passwordCInputBg.y+this._passwordCInputBg.height+i-this._loginBg.y,this._loginBg.graphics.clear(),this._loginBg.graphics.beginFill(2302755,.95),this.roundRect(this._loginBg,t,a,e),this._loginBg.graphics.endFill(),this._goBtnBg.y=this._loginBg.y+this._loginBg.height+3*i,this._goBtnLabel.y=this._goBtnBg.y+this._goBtnBg.height/2-this._goBtnLabel.height/2},e.prototype.roundRect=function(t,e,i,a){t.graphics.moveTo(a,0),t.graphics.lineTo(e-a,0),t.graphics.drawArc(e-a,a,a,-90*(Math.PI/180),0),t.graphics.lineTo(e,i-a),t.graphics.drawArc(e-a,i-a,a,0,90*(Math.PI/180)),t.graphics.lineTo(a,i),t.graphics.drawArc(a,i-a,a,90*(Math.PI/180),Math.PI),t.graphics.lineTo(0,a),t.graphics.drawArc(a,a,a,Math.PI,270*(Math.PI/180))},e.prototype.onLogin=function(){if(this._goBtnBg.touchEnabled=!1,this._goBtnLabel.touchEnabled=!1,this._switchModeBtnBg.touchEnabled=!1,this._switchModeBtnBg.touchEnabled=!1,this._isLogin){var t=new egret.HttpRequest;t.responseType=egret.HttpResponseType.TEXT,t.open(this._origin+"/auth/login",egret.HttpMethod.POST),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify({username:this._loginInput.text.trim(),password:this._passwordInput.text.trim()})),t.addEventListener(egret.Event.COMPLETE,this.onPostComplete,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this)}else{var t=new egret.HttpRequest;t.responseType=egret.HttpResponseType.TEXT,t.open(this._origin+"/auth/register",egret.HttpMethod.POST),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify({username:this._loginInput.text.trim(),password:this._passwordInput.text.trim(),passwordConfirmation:this._passwordInput.text.trim()})),t.addEventListener(egret.Event.COMPLETE,this.onPostComplete,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this)}},e.prototype.onPostComplete=function(t){var e=t.currentTarget,i=JSON.parse(e.response).userId;localStorage.setItem("proto_user_id",i),this._connection.connect(this._origin,i)},e.prototype.onPostIOError=function(t){egret.log("post error : "+t)},e.prototype.resizeBackground=function(){var t=this._viewport.toAspectSize(this._backGroundInitialSize.width);this._viewport.toAspectSize(this._backGroundInitialSize.height);if(this._parent.width>t){this._backGround.width=this._parent.width,this._backGround.height=this._backGroundInitialSize.height*(this._parent.width/this._backGroundInitialSize.width);var e=this._backGround.height-this._parent.height;this._backGround.x=0,this._backGround.y=-(e/2)}else{this._backGround.height=this._parent.height,this._backGround.width=this._backGroundInitialSize.width*(this._parent.height/this._backGroundInitialSize.height);var i=this._backGround.width-this._parent.width;this._backGround.y=0,this._backGround.x=-(i/2)}},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return this._textures.push(i),e.texture=i,e},e}(A1Scene);window.HomeScene=i,__reflect(i.prototype,"HomeScene",[])},function(t,e){},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._parent=e,i._connection=Connection.instance(),i._state=A1State.instance(),i.update=function(){i._text.x=(i._parent.width-i.width)/2,i._text.y=(i._parent.height-i.height)/2},i}return __extends(e,t),e.prototype.loadAssets=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,RES.loadGroup("preload",0,t)];case 1:return i.sent(),console.log("loadSceneAssets DONE"),this.createView(),this.update(),[3,3];case 2:return e=i.sent(),console.error(e),[3,3];case 3:return[2]}})})},e.prototype.onAddToStage=function(){},e.prototype.onViewCreated=function(){console.log("SPLASH_SCENE"),this._text=new egret.TextField,this._text.size=32,this._text.text="A1 Core Game",this.addChild(this._text),this.renderStatics()},e.prototype.renderStatics=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,s,n,r,h=this;return __generator(this,function(o){return t=this._viewport.windowProps(),e=new GameHeader(t,this._parent),e.name="gameHeader",this._parent.addChild(e),i=t.width/6-1,a=new SkillBar(i),a.y=t.height-i-1,a.name="skills",a.height=i,this._parent.addChild(a),s=e.height,n=new GameLog(t,s,e.height),n.name="gameLog",n.y=t.height-i-s-2,this._parent.addChild(n),r=new StatsScreen(this._parent),r.y=e.height,r.name="statsScreen",r.visible=!1,this._parent.addChild(r),setTimeout(function(){return __awaiter(h,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,A1State.instance().setState("GAME_SCENE")];case 1:return t.sent(),[2]}})})}),[2]})})},e}(A1Scene);window.SplashScene=i,__reflect(i.prototype,"SplashScene",[])}]);